{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/app/agentset/node_modules/%40llamaindex/env/dist/index.js"],"sourcesContent":["export { ok } from 'node:assert';\nimport { createHash } from 'node:crypto';\nexport { randomUUID } from 'node:crypto';\nexport { EOL } from 'node:os';\nexport { default as path } from 'node:path';\nexport { Readable } from 'node:stream';\nexport { fileURLToPath } from 'node:url';\nexport { createWriteStream } from 'node:fs';\nexport { default as fs } from 'node:fs/promises';\nexport { AsyncLocalStorage } from 'node:async_hooks';\n\nclass NotSupportCurrentRuntimeClass {\n    constructor(runtime){\n        throw new Error(`Current environment ${runtime} is not supported`);\n    }\n    static bind(runtime) {\n        return class extends NotSupportCurrentRuntimeClass {\n            constructor(...args){\n                super(runtime);\n            }\n        };\n    }\n}\n// This is a workaround for the lack of globalThis in some environments\n// It's being used across multiple places inside the `env` package\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst glo = typeof globalThis !== \"undefined\" ? globalThis : typeof window !== \"undefined\" ? window : typeof global !== \"undefined\" ? global : {};\n\nconst importIdentifier = \"__ $@llamaindex/env$ __\";\nif (glo[importIdentifier] === true) {\n    /**\n   * Dear reader of this message. Please take this seriously.\n   *\n   * If you see this message, make sure that you only import one version of llamaindex. In many cases,\n   * your package manager installs two versions of llamaindex that are used by different packages within your project.\n   * Another reason for this message is that some parts of your project use the CJS version of llamaindex\n   * and others use the ESM version of llamaindex.\n   *\n   * This often leads to issues that are hard to debug. We often need to perform constructor checks,\n   * e.g. `node instanceof TextNode`. If you imported different versions of llamaindex, it is impossible for us to\n   * do the constructor checks anymore - which might break the functionality of your application.\n   */ console.error(\"llamaindex was already imported. This breaks constructor checks and will lead to issues!\");\n}\nglo[importIdentifier] = true;\n\nfunction noop() {}\nconst emptyLogger = Object.freeze({\n    log: noop,\n    error: noop,\n    warn: noop\n});\nconst consoleLogger = Object.freeze({\n    log: console.log.bind(console),\n    error: console.error.bind(console),\n    warn: console.warn.bind(console)\n});\n\n// DO NOT EXPOSE THIS VARIABLE TO PUBLIC, IT IS USED INTERNALLY FOR CLOUDFLARE WORKER\nconst INTERNAL_ENV = {};\n/**\n * Set environment variables before using llamaindex, because some LLM need to access API key before running.\n *\n * You have to set the environment variables in Cloudflare Worker environment,\n * because it doesn't have any global environment variables.\n *\n * @example\n * ```ts\n * export default {\n *   async fetch(\n *     request: Request,\n *     env: Env,\n *     ctx: ExecutionContext,\n *   ): Promise<Response> {\n *     const { setEnvs } = await import(\"@llamaindex/env\");\n *     setEnvs(env);\n *     // ...\n *     return new Response(\"Hello, World!\");\n *   },\n * };\n * ```\n *\n * @param envs Environment variables\n */ function setEnvs(envs) {\n    Object.assign(INTERNAL_ENV, envs);\n}\nfunction getEnv(name) {\n    if (INTERNAL_ENV[name]) {\n        return INTERNAL_ENV[name];\n    }\n    if (typeof process === \"undefined\" || typeof process.env === \"undefined\") {\n        // @ts-expect-error Deno is not defined\n        if (typeof Deno === \"undefined\") {\n            throw new Error(\"Current environment is not supported\");\n        } else {\n            // @ts-expect-error Deno is not defined\n            return Deno.env.get(name);\n        }\n    }\n    return process.env[name];\n}\n// Node.js 18 doesn't have CustomEvent by default\n// Refs: https://github.com/nodejs/node/issues/40678\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nclass CustomEvent extends Event {\n    #detail;\n    get detail() {\n        return this.#detail;\n    }\n    constructor(event, options){\n        super(event, options);\n        this.#detail = options?.detail;\n    }\n    /**\n   * @deprecated This method is not supported\n   */ initCustomEvent() {\n        throw new Error(\"initCustomEvent is not supported\");\n    }\n}\nconst defaultCustomEvent = // eslint-disable-next-line @typescript-eslint/no-explicit-any\nglobalThis.CustomEvent || CustomEvent;\n\nfunction createSHA256() {\n    const hash = createHash(\"sha256\");\n    return {\n        update (data) {\n            hash.update(data);\n        },\n        digest () {\n            return hash.digest(\"base64\");\n        }\n    };\n}\nconst process$1 = globalThis.process;\n\nexport { defaultCustomEvent as CustomEvent, NotSupportCurrentRuntimeClass, consoleLogger, createSHA256, emptyLogger, getEnv, process$1 as process, setEnvs };\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AAEA,MAAM;IACF,YAAY,OAAO,CAAC;QAChB,MAAM,IAAI,MAAM,CAAC,oBAAoB,EAAE,QAAQ,iBAAiB,CAAC;IACrE;IACA,OAAO,KAAK,OAAO,EAAE;QACjB,OAAO,cAAc;YACjB,YAAY,GAAG,IAAI,CAAC;gBAChB,KAAK,CAAC;YACV;QACJ;IACJ;AACJ;AACA,uEAAuE;AACvE,kEAAkE;AAClE,8DAA8D;AAC9D,MAAM,MAAM,OAAO,eAAe,cAAc,aAAa,6EAAyC,OAAO,WAAW,cAAc,SAAS,CAAC;AAEhJ,MAAM,mBAAmB;AACzB,IAAI,GAAG,CAAC,iBAAiB,KAAK,MAAM;IAChC;;;;;;;;;;;GAWD,GAAG,QAAQ,KAAK,CAAC;AACpB;AACA,GAAG,CAAC,iBAAiB,GAAG;AAExB,SAAS,QAAQ;AACjB,MAAM,cAAc,OAAO,MAAM,CAAC;IAC9B,KAAK;IACL,OAAO;IACP,MAAM;AACV;AACA,MAAM,gBAAgB,OAAO,MAAM,CAAC;IAChC,KAAK,QAAQ,GAAG,CAAC,IAAI,CAAC;IACtB,OAAO,QAAQ,KAAK,CAAC,IAAI,CAAC;IAC1B,MAAM,QAAQ,IAAI,CAAC,IAAI,CAAC;AAC5B;AAEA,qFAAqF;AACrF,MAAM,eAAe,CAAC;AACtB;;;;;;;;;;;;;;;;;;;;;;;CAuBC,GAAG,SAAS,QAAQ,IAAI;IACrB,OAAO,MAAM,CAAC,cAAc;AAChC;AACA,SAAS,OAAO,IAAI;IAChB,IAAI,YAAY,CAAC,KAAK,EAAE;QACpB,OAAO,YAAY,CAAC,KAAK;IAC7B;IACA,IAAI,OAAO,YAAY,eAAe,OAAO,QAAQ,GAAG,KAAK,aAAa;QACtE,uCAAuC;QACvC,IAAI,OAAO,SAAS,aAAa;YAC7B,MAAM,IAAI,MAAM;QACpB,OAAO;YACH,uCAAuC;YACvC,OAAO,KAAK,GAAG,CAAC,GAAG,CAAC;QACxB;IACJ;IACA,OAAO,QAAQ,GAAG,CAAC,KAAK;AAC5B;AACA,iDAAiD;AACjD,oDAAoD;AACpD,8DAA8D;AAC9D,MAAM,oBAAoB;IACtB,CAAA,MAAO,CAAC;IACR,IAAI,SAAS;QACT,OAAO,IAAI,CAAC,CAAA,MAAO;IACvB;IACA,YAAY,KAAK,EAAE,OAAO,CAAC;QACvB,KAAK,CAAC,OAAO;QACb,IAAI,CAAC,CAAA,MAAO,GAAG,SAAS;IAC5B;IACA;;GAED,GAAG,kBAAkB;QAChB,MAAM,IAAI,MAAM;IACpB;AACJ;AACA,MAAM,qBACN,WAAW,WAAW,IAAI;AAE1B,SAAS;IACL,MAAM,OAAO,CAAA,GAAA,qHAAA,CAAA,aAAU,AAAD,EAAE;IACxB,OAAO;QACH,QAAQ,IAAI;YACR,KAAK,MAAM,CAAC;QAChB;QACA;YACI,OAAO,KAAK,MAAM,CAAC;QACvB;IACJ;AACJ;AACA,MAAM,YAAY,WAAW,OAAO","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 177, "column": 0}, "map": {"version":3,"sources":["file:///C:/app/agentset/node_modules/%40llamaindex/env/tokenizers/dist/index.js"],"sourcesContent":["import { getEncoding } from 'js-tiktoken';\nimport __node_cjsModule from 'node:module';\n\nvar Tokenizers = /*#__PURE__*/ function(Tokenizers) {\n    Tokenizers[\"CL100K_BASE\"] = \"cl100k_base\";\n    return Tokenizers;\n}({});\n\nconst require = __node_cjsModule.createRequire(import.meta.url);\n\nfunction tryLoadGptTokenizer() {\n    try {\n        // eslint-disable-next-line @typescript-eslint/no-require-imports\n        return require(\"gpt-tokenizer\"); // using require for CommonJS compatibility\n    } catch (e) {\n        return null;\n    }\n}\nconst gptTokenizerModule = tryLoadGptTokenizer();\nclass TokenizerSingleton {\n    #defaultTokenizer;\n    constructor(){\n        // Use gpt-tokenizer if available, otherwise use js-tiktoken\n        if (gptTokenizerModule) {\n            this.#defaultTokenizer = {\n                encode: (text)=>{\n                    return new Uint32Array(gptTokenizerModule.encode(text));\n                },\n                decode: (tokens)=>{\n                    return gptTokenizerModule.decode(Array.from(tokens));\n                }\n            };\n        } else {\n            // Fall back to js-tiktoken which is always available\n            // Note: js-tiktoken it's 60x slower than gpt-tokenizer\n            const encoding = getEncoding(\"cl100k_base\");\n            this.#defaultTokenizer = {\n                encode: (text)=>{\n                    return new Uint32Array(encoding.encode(text));\n                },\n                decode: (tokens)=>{\n                    const numberArray = Array.from(tokens);\n                    const text = encoding.decode(numberArray);\n                    const uint8Array = new TextEncoder().encode(text);\n                    return new TextDecoder().decode(uint8Array);\n                }\n            };\n        }\n    }\n    tokenizer(encoding) {\n        if (encoding && encoding !== Tokenizers.CL100K_BASE) {\n            throw new Error(`Tokenizer encoding ${encoding} not yet supported`);\n        }\n        return this.#defaultTokenizer;\n    }\n}\nconst tokenizers = new TokenizerSingleton();\n\nexport { Tokenizers, tokenizers };\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;;;;;;AAEA,IAAI,aAAa,WAAW,GAAG,SAAS,UAAU;IAC9C,UAAU,CAAC,cAAc,GAAG;IAC5B,OAAO;AACX,EAAE,CAAC;AAEH,MAAM,UAAU,qHAAA,CAAA,UAAgB,CAAC,aAAa,CAAC,8BAAY,GAAG;AAE9D,SAAS;IACL,IAAI;QACA,iEAAiE;QACjE,OAAO,QAAQ,kBAAkB,2CAA2C;IAChF,EAAE,OAAO,GAAG;QACR,OAAO;IACX;AACJ;AACA,MAAM,qBAAqB;AAC3B,MAAM;IACF,CAAA,gBAAiB,CAAC;IAClB,aAAa;QACT,4DAA4D;QAC5D,IAAI,oBAAoB;YACpB,IAAI,CAAC,CAAA,gBAAiB,GAAG;gBACrB,QAAQ,CAAC;oBACL,OAAO,IAAI,YAAY,mBAAmB,MAAM,CAAC;gBACrD;gBACA,QAAQ,CAAC;oBACL,OAAO,mBAAmB,MAAM,CAAC,MAAM,IAAI,CAAC;gBAChD;YACJ;QACJ,OAAO;YACH,qDAAqD;YACrD,uDAAuD;YACvD,MAAM,WAAW,CAAA,GAAA,+JAAA,CAAA,cAAW,AAAD,EAAE;YAC7B,IAAI,CAAC,CAAA,gBAAiB,GAAG;gBACrB,QAAQ,CAAC;oBACL,OAAO,IAAI,YAAY,SAAS,MAAM,CAAC;gBAC3C;gBACA,QAAQ,CAAC;oBACL,MAAM,cAAc,MAAM,IAAI,CAAC;oBAC/B,MAAM,OAAO,SAAS,MAAM,CAAC;oBAC7B,MAAM,aAAa,IAAI,cAAc,MAAM,CAAC;oBAC5C,OAAO,IAAI,cAAc,MAAM,CAAC;gBACpC;YACJ;QACJ;IACJ;IACA,UAAU,QAAQ,EAAE;QAChB,IAAI,YAAY,aAAa,WAAW,WAAW,EAAE;YACjD,MAAM,IAAI,MAAM,CAAC,mBAAmB,EAAE,SAAS,kBAAkB,CAAC;QACtE;QACA,OAAO,IAAI,CAAC,CAAA,gBAAiB;IACjC;AACJ;AACA,MAAM,aAAa,IAAI","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 250, "column": 0}, "map": {"version":3,"sources":["file:///C:/app/agentset/node_modules/%40llamaindex/openai/dist/index.js"],"sourcesContent":["import { LLMAgentWorker, LLMAgent } from '@llamaindex/core/agent';\nimport { Settings } from '@llamaindex/core/global';\nimport { wrapEventCaller, wrapLLMEvent } from '@llamaindex/core/decorator';\nimport { ToolCallLLM } from '@llamaindex/core/llms';\nimport { extractText } from '@llamaindex/core/utils';\nimport { getEnv, process } from '@llamaindex/env';\nimport { Tokenizers } from '@llamaindex/env/tokenizers';\nimport { BaseEmbedding } from '@llamaindex/core/embeddings';\n\nvar name = \"@llamaindex/openai\";\nvar version = \"0.1.61\";\nvar pkg = {\n\tname: name,\n\tversion: version};\n\n// NOTE we're not supporting the legacy models as they're not available for new deployments\n// https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/legacy-models\n// If you have a need for them, please open an issue on GitHub\nconst ALL_AZURE_OPENAI_CHAT_MODELS = {\n    \"gpt-35-turbo\": {\n        contextWindow: 4096,\n        openAIModel: \"gpt-3.5-turbo\"\n    },\n    \"gpt-35-turbo-16k\": {\n        contextWindow: 16384,\n        openAIModel: \"gpt-3.5-turbo-16k\"\n    },\n    \"gpt-4o\": {\n        contextWindow: 128000,\n        openAIModel: \"gpt-4o\"\n    },\n    \"gpt-4o-mini\": {\n        contextWindow: 128000,\n        openAIModel: \"gpt-4o-mini\"\n    },\n    \"gpt-4\": {\n        contextWindow: 8192,\n        openAIModel: \"gpt-4\"\n    },\n    \"gpt-4-32k\": {\n        contextWindow: 32768,\n        openAIModel: \"gpt-4-32k\"\n    },\n    \"gpt-4-turbo\": {\n        contextWindow: 128000,\n        openAIModel: \"gpt-4-turbo\"\n    },\n    \"gpt-4-turbo-2024-04-09\": {\n        contextWindow: 128000,\n        openAIModel: \"gpt-4-turbo\"\n    },\n    \"gpt-4-vision-preview\": {\n        contextWindow: 128000,\n        openAIModel: \"gpt-4-vision-preview\"\n    },\n    \"gpt-4-1106-preview\": {\n        contextWindow: 128000,\n        openAIModel: \"gpt-4-1106-preview\"\n    },\n    \"gpt-4o-2024-05-13\": {\n        contextWindow: 128000,\n        openAIModel: \"gpt-4o-2024-05-13\"\n    },\n    \"gpt-4o-mini-2024-07-18\": {\n        contextWindow: 128000,\n        openAIModel: \"gpt-4o-mini-2024-07-18\"\n    }\n};\nconst ALL_AZURE_OPENAI_EMBEDDING_MODELS = {\n    \"text-embedding-ada-002\": {\n        dimensions: 1536,\n        openAIModel: \"text-embedding-ada-002\",\n        maxTokens: 8191\n    },\n    \"text-embedding-3-small\": {\n        dimensions: 1536,\n        dimensionOptions: [\n            512,\n            1536\n        ],\n        openAIModel: \"text-embedding-3-small\",\n        maxTokens: 8191\n    },\n    \"text-embedding-3-large\": {\n        dimensions: 3072,\n        dimensionOptions: [\n            256,\n            1024,\n            3072\n        ],\n        openAIModel: \"text-embedding-3-large\",\n        maxTokens: 8191\n    }\n};\n// Current version list found here - https://learn.microsoft.com/en-us/azure/ai-services/openai/reference\n// const ALL_AZURE_API_VERSIONS = [\n//   \"2022-12-01\",\n//   \"2023-05-15\",\n//   \"2023-06-01-preview\", // Maintained for DALL-E 2\n//   \"2023-10-01-preview\",\n//   \"2024-02-01\",\n//   \"2024-02-15-preview\",\n//   \"2024-03-01-preview\",\n//   \"2024-04-01-preview\",\n//   \"2024-05-01-preview\",\n//   \"2024-06-01\",\n// ];\nconst DEFAULT_API_VERSION = \"2023-05-15\";\n//^ NOTE: this will change over time, if you want to pin it, use a specific version\nfunction getAzureConfigFromEnv(init) {\n    const deployment = init && \"deploymentName\" in init && typeof init.deploymentName === \"string\" ? init?.deploymentName : init?.deployment ?? getEnv(\"AZURE_OPENAI_DEPLOYMENT\") ?? // From Azure docs\n    getEnv(\"AZURE_OPENAI_API_DEPLOYMENT_NAME\") ?? // LCJS compatible\n    init?.model; // Fall back to model name, Python compatible\n    return {\n        apiKey: init?.apiKey ?? getEnv(\"AZURE_OPENAI_KEY\") ?? // From Azure docs\n        getEnv(\"OPENAI_API_KEY\") ?? // Python compatible\n        getEnv(\"AZURE_OPENAI_API_KEY\"),\n        endpoint: init?.endpoint ?? getEnv(\"AZURE_OPENAI_ENDPOINT\") ?? // From Azure docs\n        getEnv(\"OPENAI_API_BASE\") ?? // Python compatible\n        getEnv(\"AZURE_OPENAI_API_INSTANCE_NAME\"),\n        apiVersion: init?.apiVersion ?? getEnv(\"AZURE_OPENAI_API_VERSION\") ?? // From Azure docs\n        getEnv(\"OPENAI_API_VERSION\") ?? // Python compatible\n        getEnv(\"AZURE_OPENAI_API_VERSION\") ?? // LCJS compatible\n        DEFAULT_API_VERSION,\n        deployment\n    };\n}\nfunction getAzureModel(openAIModel) {\n    for (const [key, value] of Object.entries(ALL_AZURE_OPENAI_EMBEDDING_MODELS)){\n        if (value.openAIModel === openAIModel) {\n            return key;\n        }\n    }\n    for (const [key, value] of Object.entries(ALL_AZURE_OPENAI_CHAT_MODELS)){\n        if (value.openAIModel === openAIModel) {\n            return key;\n        }\n    }\n    throw new Error(`Unknown model: ${openAIModel}`);\n}\nfunction shouldUseAzure() {\n    return getEnv(\"AZURE_OPENAI_ENDPOINT\") || getEnv(\"AZURE_OPENAI_API_INSTANCE_NAME\") || getEnv(\"OPENAI_API_TYPE\") === \"azure\";\n}\n// This mixin adds a User-Agent header to the request for Azure OpenAI\nfunction AzureOpenAIWithUserAgent(Base) {\n    return class AzureOpenAI extends Base {\n        // Define a new public method that wraps the base class's defaultHeaders\n        defaultHeaders(opts) {\n            const baseHeaders = super.defaultHeaders(opts);\n            return {\n                ...baseHeaders,\n                \"User-Agent\": `${pkg.name}/${pkg.version} (node.js/${process.version}; ${process.platform}; ${process.arch}) ${baseHeaders[\"User-Agent\"] || \"\"}`\n            };\n        }\n    };\n}\n\nfunction applyDecs2203RFactory() {\n    function createAddInitializerMethod(initializers, decoratorFinishedRef) {\n        return function addInitializer(initializer) {\n            assertNotFinished(decoratorFinishedRef, \"addInitializer\");\n            assertCallable(initializer, \"An initializer\");\n            initializers.push(initializer);\n        };\n    }\n    function memberDec(dec, name, desc, initializers, kind, isStatic, isPrivate, metadata, value) {\n        var kindStr;\n        switch(kind){\n            case 1:\n                kindStr = \"accessor\";\n                break;\n            case 2:\n                kindStr = \"method\";\n                break;\n            case 3:\n                kindStr = \"getter\";\n                break;\n            case 4:\n                kindStr = \"setter\";\n                break;\n            default:\n                kindStr = \"field\";\n        }\n        var ctx = {\n            kind: kindStr,\n            name: isPrivate ? \"#\" + name : name,\n            static: isStatic,\n            private: isPrivate,\n            metadata: metadata\n        };\n        var decoratorFinishedRef = {\n            v: false\n        };\n        ctx.addInitializer = createAddInitializerMethod(initializers, decoratorFinishedRef);\n        var get, set;\n        if (kind === 0) {\n            if (isPrivate) {\n                get = desc.get;\n                set = desc.set;\n            } else {\n                get = function() {\n                    return this[name];\n                };\n                set = function(v) {\n                    this[name] = v;\n                };\n            }\n        } else if (kind === 2) {\n            get = function() {\n                return desc.value;\n            };\n        } else {\n            if (kind === 1 || kind === 3) {\n                get = function() {\n                    return desc.get.call(this);\n                };\n            }\n            if (kind === 1 || kind === 4) {\n                set = function(v) {\n                    desc.set.call(this, v);\n                };\n            }\n        }\n        ctx.access = get && set ? {\n            get: get,\n            set: set\n        } : get ? {\n            get: get\n        } : {\n            set: set\n        };\n        try {\n            return dec(value, ctx);\n        } finally{\n            decoratorFinishedRef.v = true;\n        }\n    }\n    function assertNotFinished(decoratorFinishedRef, fnName) {\n        if (decoratorFinishedRef.v) {\n            throw new Error(\"attempted to call \" + fnName + \" after decoration was finished\");\n        }\n    }\n    function assertCallable(fn, hint) {\n        if (typeof fn !== \"function\") {\n            throw new TypeError(hint + \" must be a function\");\n        }\n    }\n    function assertValidReturnValue(kind, value) {\n        var type = typeof value;\n        if (kind === 1) {\n            if (type !== \"object\" || value === null) {\n                throw new TypeError(\"accessor decorators must return an object with get, set, or init properties or void 0\");\n            }\n            if (value.get !== undefined) {\n                assertCallable(value.get, \"accessor.get\");\n            }\n            if (value.set !== undefined) {\n                assertCallable(value.set, \"accessor.set\");\n            }\n            if (value.init !== undefined) {\n                assertCallable(value.init, \"accessor.init\");\n            }\n        } else if (type !== \"function\") {\n            var hint;\n            if (kind === 0) {\n                hint = \"field\";\n            } else if (kind === 10) {\n                hint = \"class\";\n            } else {\n                hint = \"method\";\n            }\n            throw new TypeError(hint + \" decorators must return a function or void 0\");\n        }\n    }\n    function applyMemberDec(ret, base, decInfo, name, kind, isStatic, isPrivate, initializers, metadata) {\n        var decs = decInfo[0];\n        var desc, init, value;\n        if (isPrivate) {\n            if (kind === 0 || kind === 1) {\n                desc = {\n                    get: decInfo[3],\n                    set: decInfo[4]\n                };\n            } else if (kind === 3) {\n                desc = {\n                    get: decInfo[3]\n                };\n            } else if (kind === 4) {\n                desc = {\n                    set: decInfo[3]\n                };\n            } else {\n                desc = {\n                    value: decInfo[3]\n                };\n            }\n        } else if (kind !== 0) {\n            desc = Object.getOwnPropertyDescriptor(base, name);\n        }\n        if (kind === 1) {\n            value = {\n                get: desc.get,\n                set: desc.set\n            };\n        } else if (kind === 2) {\n            value = desc.value;\n        } else if (kind === 3) {\n            value = desc.get;\n        } else if (kind === 4) {\n            value = desc.set;\n        }\n        var newValue, get, set;\n        if (typeof decs === \"function\") {\n            newValue = memberDec(decs, name, desc, initializers, kind, isStatic, isPrivate, metadata, value);\n            if (newValue !== void 0) {\n                assertValidReturnValue(kind, newValue);\n                if (kind === 0) {\n                    init = newValue;\n                } else if (kind === 1) {\n                    init = newValue.init;\n                    get = newValue.get || value.get;\n                    set = newValue.set || value.set;\n                    value = {\n                        get: get,\n                        set: set\n                    };\n                } else {\n                    value = newValue;\n                }\n            }\n        } else {\n            for(var i = decs.length - 1; i >= 0; i--){\n                var dec = decs[i];\n                newValue = memberDec(dec, name, desc, initializers, kind, isStatic, isPrivate, metadata, value);\n                if (newValue !== void 0) {\n                    assertValidReturnValue(kind, newValue);\n                    var newInit;\n                    if (kind === 0) {\n                        newInit = newValue;\n                    } else if (kind === 1) {\n                        newInit = newValue.init;\n                        get = newValue.get || value.get;\n                        set = newValue.set || value.set;\n                        value = {\n                            get: get,\n                            set: set\n                        };\n                    } else {\n                        value = newValue;\n                    }\n                    if (newInit !== void 0) {\n                        if (init === void 0) {\n                            init = newInit;\n                        } else if (typeof init === \"function\") {\n                            init = [\n                                init,\n                                newInit\n                            ];\n                        } else {\n                            init.push(newInit);\n                        }\n                    }\n                }\n            }\n        }\n        if (kind === 0 || kind === 1) {\n            if (init === void 0) {\n                init = function(instance, init) {\n                    return init;\n                };\n            } else if (typeof init !== \"function\") {\n                var ownInitializers = init;\n                init = function(instance, init) {\n                    var value = init;\n                    for(var i = 0; i < ownInitializers.length; i++){\n                        value = ownInitializers[i].call(instance, value);\n                    }\n                    return value;\n                };\n            } else {\n                var originalInitializer = init;\n                init = function(instance, init) {\n                    return originalInitializer.call(instance, init);\n                };\n            }\n            ret.push(init);\n        }\n        if (kind !== 0) {\n            if (kind === 1) {\n                desc.get = value.get;\n                desc.set = value.set;\n            } else if (kind === 2) {\n                desc.value = value;\n            } else if (kind === 3) {\n                desc.get = value;\n            } else if (kind === 4) {\n                desc.set = value;\n            }\n            if (isPrivate) {\n                if (kind === 1) {\n                    ret.push(function(instance, args) {\n                        return value.get.call(instance, args);\n                    });\n                    ret.push(function(instance, args) {\n                        return value.set.call(instance, args);\n                    });\n                } else if (kind === 2) {\n                    ret.push(value);\n                } else {\n                    ret.push(function(instance, args) {\n                        return value.call(instance, args);\n                    });\n                }\n            } else {\n                Object.defineProperty(base, name, desc);\n            }\n        }\n    }\n    function applyMemberDecs(Class, decInfos, metadata) {\n        var ret = [];\n        var protoInitializers;\n        var staticInitializers;\n        var existingProtoNonFields = new Map();\n        var existingStaticNonFields = new Map();\n        for(var i = 0; i < decInfos.length; i++){\n            var decInfo = decInfos[i];\n            if (!Array.isArray(decInfo)) continue;\n            var kind = decInfo[1];\n            var name = decInfo[2];\n            var isPrivate = decInfo.length > 3;\n            var isStatic = kind >= 5;\n            var base;\n            var initializers;\n            if (isStatic) {\n                base = Class;\n                kind = kind - 5;\n                staticInitializers = staticInitializers || [];\n                initializers = staticInitializers;\n            } else {\n                base = Class.prototype;\n                protoInitializers = protoInitializers || [];\n                initializers = protoInitializers;\n            }\n            if (kind !== 0 && !isPrivate) {\n                var existingNonFields = isStatic ? existingStaticNonFields : existingProtoNonFields;\n                var existingKind = existingNonFields.get(name) || 0;\n                if (existingKind === true || existingKind === 3 && kind !== 4 || existingKind === 4 && kind !== 3) {\n                    throw new Error(\"Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: \" + name);\n                } else if (!existingKind && kind > 2) {\n                    existingNonFields.set(name, kind);\n                } else {\n                    existingNonFields.set(name, true);\n                }\n            }\n            applyMemberDec(ret, base, decInfo, name, kind, isStatic, isPrivate, initializers, metadata);\n        }\n        pushInitializers(ret, protoInitializers);\n        pushInitializers(ret, staticInitializers);\n        return ret;\n    }\n    function pushInitializers(ret, initializers) {\n        if (initializers) {\n            ret.push(function(instance) {\n                for(var i = 0; i < initializers.length; i++){\n                    initializers[i].call(instance);\n                }\n                return instance;\n            });\n        }\n    }\n    function applyClassDecs(targetClass, classDecs, metadata) {\n        if (classDecs.length > 0) {\n            var initializers = [];\n            var newClass = targetClass;\n            var name = targetClass.name;\n            for(var i = classDecs.length - 1; i >= 0; i--){\n                var decoratorFinishedRef = {\n                    v: false\n                };\n                try {\n                    var nextNewClass = classDecs[i](newClass, {\n                        kind: \"class\",\n                        name: name,\n                        addInitializer: createAddInitializerMethod(initializers, decoratorFinishedRef),\n                        metadata\n                    });\n                } finally{\n                    decoratorFinishedRef.v = true;\n                }\n                if (nextNewClass !== undefined) {\n                    assertValidReturnValue(10, nextNewClass);\n                    newClass = nextNewClass;\n                }\n            }\n            return [\n                defineMetadata(newClass, metadata),\n                function() {\n                    for(var i = 0; i < initializers.length; i++){\n                        initializers[i].call(newClass);\n                    }\n                }\n            ];\n        }\n    }\n    function defineMetadata(Class, metadata) {\n        return Object.defineProperty(Class, Symbol.metadata || Symbol.for(\"Symbol.metadata\"), {\n            configurable: true,\n            enumerable: true,\n            value: metadata\n        });\n    }\n    return function applyDecs2203R(targetClass, memberDecs, classDecs, parentClass) {\n        if (parentClass !== void 0) {\n            var parentMetadata = parentClass[Symbol.metadata || Symbol.for(\"Symbol.metadata\")];\n        }\n        var metadata = Object.create(parentMetadata === void 0 ? null : parentMetadata);\n        var e = applyMemberDecs(targetClass, memberDecs, metadata);\n        if (!classDecs.length) defineMetadata(targetClass, metadata);\n        return {\n            e: e,\n            get c () {\n                return applyClassDecs(targetClass, classDecs, metadata);\n            }\n        };\n    };\n}\nfunction _apply_decs_2203_r(targetClass, memberDecs, classDecs, parentClass) {\n    return (_apply_decs_2203_r = applyDecs2203RFactory())(targetClass, memberDecs, classDecs, parentClass);\n}\nvar _initProto;\nconst GPT4_MODELS = {\n    \"chatgpt-4o-latest\": {\n        contextWindow: 128000\n    },\n    \"gpt-4.5-preview\": {\n        contextWindow: 128000\n    },\n    \"gpt-4.5-preview-2025-02-27\": {\n        contextWindow: 128000\n    },\n    \"gpt-4\": {\n        contextWindow: 8192\n    },\n    \"gpt-4-32k\": {\n        contextWindow: 32768\n    },\n    \"gpt-4-32k-0613\": {\n        contextWindow: 32768\n    },\n    \"gpt-4-turbo\": {\n        contextWindow: 128000\n    },\n    \"gpt-4-turbo-preview\": {\n        contextWindow: 128000\n    },\n    \"gpt-4-1106-preview\": {\n        contextWindow: 128000\n    },\n    \"gpt-4-0125-preview\": {\n        contextWindow: 128000\n    },\n    \"gpt-4-vision-preview\": {\n        contextWindow: 128000\n    },\n    \"gpt-4o\": {\n        contextWindow: 128000\n    },\n    \"gpt-4o-2024-05-13\": {\n        contextWindow: 128000\n    },\n    \"gpt-4o-mini\": {\n        contextWindow: 128000\n    },\n    \"gpt-4o-mini-2024-07-18\": {\n        contextWindow: 128000\n    },\n    \"gpt-4o-2024-08-06\": {\n        contextWindow: 128000\n    },\n    \"gpt-4o-2024-09-14\": {\n        contextWindow: 128000\n    },\n    \"gpt-4o-2024-10-14\": {\n        contextWindow: 128000\n    },\n    \"gpt-4-0613\": {\n        contextWindow: 128000\n    },\n    \"gpt-4-turbo-2024-04-09\": {\n        contextWindow: 128000\n    },\n    \"gpt-4-0314\": {\n        contextWindow: 128000\n    },\n    \"gpt-4-32k-0314\": {\n        contextWindow: 32768\n    },\n    \"gpt-4o-realtime-preview\": {\n        contextWindow: 128000\n    },\n    \"gpt-4o-realtime-preview-2024-10-01\": {\n        contextWindow: 128000\n    },\n    \"gpt-4o-audio-preview\": {\n        contextWindow: 128000\n    },\n    \"gpt-4o-audio-preview-2024-10-01\": {\n        contextWindow: 128000\n    },\n    \"gpt-4o-2024-11-20\": {\n        contextWindow: 128000\n    },\n    \"gpt-4o-audio-preview-2024-12-17\": {\n        contextWindow: 128000\n    },\n    \"gpt-4o-mini-audio-preview\": {\n        contextWindow: 128000\n    },\n    \"gpt-4o-mini-audio-preview-2024-12-17\": {\n        contextWindow: 128000\n    }\n};\n// NOTE we don't currently support gpt-3.5-turbo-instruct and don't plan to in the near future\nconst GPT35_MODELS = {\n    \"gpt-3.5-turbo\": {\n        contextWindow: 16385\n    },\n    \"gpt-3.5-turbo-0613\": {\n        contextWindow: 4096\n    },\n    \"gpt-3.5-turbo-16k\": {\n        contextWindow: 16385\n    },\n    \"gpt-3.5-turbo-16k-0613\": {\n        contextWindow: 16385\n    },\n    \"gpt-3.5-turbo-1106\": {\n        contextWindow: 16385\n    },\n    \"gpt-3.5-turbo-0125\": {\n        contextWindow: 16385\n    },\n    \"gpt-3.5-turbo-0301\": {\n        contextWindow: 16385\n    }\n};\nconst O1_MODELS = {\n    \"o1-preview\": {\n        contextWindow: 128000\n    },\n    \"o1-preview-2024-09-12\": {\n        contextWindow: 128000\n    },\n    \"o1-mini\": {\n        contextWindow: 128000\n    },\n    \"o1-mini-2024-09-12\": {\n        contextWindow: 128000\n    },\n    o1: {\n        contextWindow: 128000\n    },\n    \"o1-2024-12-17\": {\n        contextWindow: 128000\n    }\n};\nconst O3_MODELS = {\n    \"o3-mini\": {\n        contextWindow: 200000\n    },\n    \"o3-mini-2025-01-31\": {\n        contextWindow: 200000\n    }\n};\n/**\n * We currently support GPT-3.5 and GPT-4 models\n */ const ALL_AVAILABLE_OPENAI_MODELS = {\n    ...GPT4_MODELS,\n    ...GPT35_MODELS,\n    ...O1_MODELS,\n    ...O3_MODELS\n};\nfunction isFunctionCallingModel(llm) {\n    let model;\n    if (llm instanceof OpenAI) {\n        model = llm.model;\n    } else if (\"model\" in llm && typeof llm.model === \"string\") {\n        model = llm.model;\n    } else {\n        return false;\n    }\n    const isChatModel = Object.keys(ALL_AVAILABLE_OPENAI_MODELS).includes(model);\n    const isOld = model.includes(\"0314\") || model.includes(\"0301\");\n    const isO1 = model.startsWith(\"o1\");\n    return isChatModel && !isOld && !isO1;\n}\nfunction isReasoningModel(model) {\n    const isO1 = model.startsWith(\"o1\");\n    const isO3 = model.startsWith(\"o3\");\n    return isO1 || isO3;\n}\nfunction isTemperatureSupported(model) {\n    return !model.startsWith(\"o3\");\n}\nclass OpenAI extends ToolCallLLM {\n    static{\n        ({ e: [_initProto] } = _apply_decs_2203_r(this, [\n            [\n                [\n                    wrapEventCaller,\n                    wrapLLMEvent\n                ],\n                2,\n                \"chat\"\n            ],\n            [\n                wrapEventCaller,\n                2,\n                \"streamChat\"\n            ]\n        ], []));\n    }\n    #session;\n    get session() {\n        if (!this.#session) {\n            this.#session = this.lazySession();\n        }\n        return this.#session;\n    }\n    constructor(init){\n        super(), // OpenAI session params\n        this.apiKey = (_initProto(this), undefined), this.baseURL = undefined, this.#session = null;\n        this.model = init?.model ?? \"gpt-4o\";\n        this.temperature = init?.temperature ?? 0.1;\n        this.reasoningEffort = isReasoningModel(this.model) ? init?.reasoningEffort : undefined;\n        this.topP = init?.topP ?? 1;\n        this.maxTokens = init?.maxTokens ?? undefined;\n        this.maxRetries = init?.maxRetries ?? 10;\n        this.timeout = init?.timeout ?? 60 * 1000; // Default is 60 seconds\n        this.additionalChatOptions = init?.additionalChatOptions;\n        this.additionalSessionOptions = init?.additionalSessionOptions;\n        this.apiKey = init?.session?.apiKey ?? init?.apiKey ?? getEnv(\"OPENAI_API_KEY\");\n        this.baseURL = init?.session?.baseURL ?? init?.baseURL ?? getEnv(\"OPENAI_BASE_URL\");\n        if (init?.azure || shouldUseAzure()) {\n            const azureConfig = {\n                ...getAzureConfigFromEnv({\n                    model: getAzureModel(this.model)\n                }),\n                ...init?.azure\n            };\n            this.lazySession = async ()=>init?.session ?? import('openai').then(({ AzureOpenAI })=>{\n                    AzureOpenAI = AzureOpenAIWithUserAgent(AzureOpenAI);\n                    return new AzureOpenAI({\n                        maxRetries: this.maxRetries,\n                        timeout: this.timeout,\n                        ...this.additionalSessionOptions,\n                        ...azureConfig\n                    });\n                });\n        } else {\n            this.lazySession = async ()=>init?.session ?? import('openai').then(({ OpenAI })=>{\n                    return new OpenAI({\n                        apiKey: this.apiKey,\n                        baseURL: this.baseURL,\n                        maxRetries: this.maxRetries,\n                        timeout: this.timeout,\n                        ...this.additionalSessionOptions\n                    });\n                });\n        }\n    }\n    get supportToolCall() {\n        return isFunctionCallingModel(this);\n    }\n    get metadata() {\n        const contextWindow = ALL_AVAILABLE_OPENAI_MODELS[this.model]?.contextWindow ?? 1024;\n        return {\n            model: this.model,\n            temperature: this.temperature,\n            topP: this.topP,\n            maxTokens: this.maxTokens,\n            contextWindow,\n            tokenizer: Tokenizers.CL100K_BASE\n        };\n    }\n    static toOpenAIRole(messageType) {\n        switch(messageType){\n            case \"user\":\n                return \"user\";\n            case \"assistant\":\n                return \"assistant\";\n            case \"system\":\n                return \"system\";\n            default:\n                return \"user\";\n        }\n    }\n    static toOpenAIMessage(messages) {\n        return messages.map((message)=>{\n            const options = message.options ?? {};\n            if (\"toolResult\" in options) {\n                return {\n                    tool_call_id: options.toolResult.id,\n                    role: \"tool\",\n                    content: extractText(message.content)\n                };\n            } else if (\"toolCall\" in options) {\n                return {\n                    role: \"assistant\",\n                    content: extractText(message.content),\n                    tool_calls: options.toolCall.map((toolCall)=>{\n                        return {\n                            id: toolCall.id,\n                            type: \"function\",\n                            function: {\n                                name: toolCall.name,\n                                arguments: typeof toolCall.input === \"string\" ? toolCall.input : JSON.stringify(toolCall.input)\n                            }\n                        };\n                    })\n                };\n            } else if (message.role === \"user\") {\n                return {\n                    role: \"user\",\n                    content: message.content\n                };\n            }\n            const response = {\n                // fixme(alex): type assertion\n                role: OpenAI.toOpenAIRole(message.role),\n                // fixme: should not extract text, but assert content is string\n                content: extractText(message.content)\n            };\n            return response;\n        });\n    }\n    async chat(params) {\n        const { messages, stream, tools, additionalChatOptions } = params;\n        const baseRequestParams = {\n            model: this.model,\n            temperature: this.temperature,\n            reasoning_effort: this.reasoningEffort,\n            max_tokens: this.maxTokens,\n            tools: tools?.map(OpenAI.toTool),\n            messages: OpenAI.toOpenAIMessage(messages),\n            top_p: this.topP,\n            ...Object.assign({}, this.additionalChatOptions, additionalChatOptions)\n        };\n        if (Array.isArray(baseRequestParams.tools) && baseRequestParams.tools.length === 0) {\n            // remove empty tools array to avoid OpenAI error\n            delete baseRequestParams.tools;\n        }\n        if (!isTemperatureSupported(baseRequestParams.model)) delete baseRequestParams.temperature;\n        // Streaming\n        if (stream) {\n            return this.streamChat(baseRequestParams);\n        }\n        // Non-streaming\n        const response = await (await this.session).chat.completions.create({\n            ...baseRequestParams,\n            stream: false\n        });\n        const content = response.choices[0].message?.content ?? \"\";\n        return {\n            raw: response,\n            message: {\n                content,\n                role: response.choices[0].message.role,\n                options: response.choices[0].message?.tool_calls ? {\n                    toolCall: response.choices[0].message.tool_calls.map((toolCall)=>({\n                            id: toolCall.id,\n                            name: toolCall.function.name,\n                            input: toolCall.function.arguments\n                        }))\n                } : {}\n            }\n        };\n    }\n    // todo: this wrapper is ugly, refactor it\n    async *streamChat(baseRequestParams) {\n        const stream = await (await this.session).chat.completions.create({\n            ...baseRequestParams,\n            stream: true\n        });\n        // TODO: add callback to streamConverter and use streamConverter here\n        // this will be used to keep track of the current tool call, make sure input are valid json object.\n        let currentToolCall = null;\n        const toolCallMap = new Map();\n        for await (const part of stream){\n            if (part.choices.length === 0) {\n                if (part.usage) {\n                    yield {\n                        raw: part,\n                        delta: \"\"\n                    };\n                }\n                continue;\n            }\n            const choice = part.choices[0];\n            // skip parts that don't have any content\n            if (!(choice.delta.content || choice.delta.tool_calls || choice.finish_reason)) continue;\n            let shouldEmitToolCall = null;\n            if (choice.delta.tool_calls?.[0].id && currentToolCall && choice.delta.tool_calls?.[0].id !== currentToolCall.id) {\n                shouldEmitToolCall = {\n                    ...currentToolCall,\n                    input: JSON.parse(currentToolCall.input)\n                };\n            }\n            if (choice.delta.tool_calls?.[0].id) {\n                currentToolCall = {\n                    name: choice.delta.tool_calls[0].function.name,\n                    id: choice.delta.tool_calls[0].id,\n                    input: choice.delta.tool_calls[0].function.arguments\n                };\n                toolCallMap.set(choice.delta.tool_calls[0].id, currentToolCall);\n            } else {\n                if (choice.delta.tool_calls?.[0].function?.arguments) {\n                    currentToolCall.input += choice.delta.tool_calls[0].function.arguments;\n                }\n            }\n            const isDone = choice.finish_reason !== null;\n            if (isDone && currentToolCall) {\n                // for the last one, we need to emit the tool call\n                shouldEmitToolCall = {\n                    ...currentToolCall,\n                    input: JSON.parse(currentToolCall.input)\n                };\n            }\n            yield {\n                raw: part,\n                options: shouldEmitToolCall ? {\n                    toolCall: [\n                        shouldEmitToolCall\n                    ]\n                } : currentToolCall ? {\n                    toolCall: [\n                        currentToolCall\n                    ]\n                } : {},\n                delta: choice.delta.content ?? \"\"\n            };\n        }\n        toolCallMap.clear();\n        return;\n    }\n    static toTool(tool) {\n        return {\n            type: \"function\",\n            function: tool.metadata.parameters ? {\n                name: tool.metadata.name,\n                description: tool.metadata.description,\n                parameters: tool.metadata.parameters\n            } : {\n                name: tool.metadata.name,\n                description: tool.metadata.description\n            }\n        };\n    }\n}\n/**\n * Convenience function to create a new OpenAI instance.\n * @param init - Optional initialization parameters for the OpenAI instance.\n * @returns A new OpenAI instance.\n */ const openai = (init)=>new OpenAI(init);\n\nclass OpenAIAgentWorker extends LLMAgentWorker {\n}\nclass OpenAIAgent extends LLMAgent {\n    constructor(params){\n        const llm = params.llm ?? (Settings.llm instanceof OpenAI ? Settings.llm : new OpenAI());\n        super({\n            ...params,\n            llm\n        });\n    }\n}\n\nconst ALL_OPENAI_EMBEDDING_MODELS = {\n    \"text-embedding-ada-002\": {\n        dimensions: 1536,\n        maxTokens: 8192,\n        tokenizer: Tokenizers.CL100K_BASE\n    },\n    \"text-embedding-3-small\": {\n        dimensions: 1536,\n        dimensionOptions: [\n            512,\n            1536\n        ],\n        maxTokens: 8192,\n        tokenizer: Tokenizers.CL100K_BASE\n    },\n    \"text-embedding-3-large\": {\n        dimensions: 3072,\n        dimensionOptions: [\n            256,\n            1024,\n            3072\n        ],\n        maxTokens: 8192,\n        tokenizer: Tokenizers.CL100K_BASE\n    }\n};\nclass OpenAIEmbedding extends BaseEmbedding {\n    #session;\n    get session() {\n        if (!this.#session) {\n            this.#session = this.lazySession();\n        }\n        return this.#session;\n    }\n    /**\n   * OpenAI Embedding\n   * @param init - initial parameters\n   */ constructor(init){\n        super(), // OpenAI session params\n        /** api key */ this.apiKey = undefined, /** base url */ this.baseURL = undefined, this.#session = null, /**\n   * Get embeddings for a batch of texts\n   * @param texts\n   */ this.getTextEmbeddings = async (texts)=>{\n            return this.getOpenAIEmbedding(texts);\n        };\n        this.model = init?.model ?? \"text-embedding-ada-002\";\n        this.dimensions = init?.dimensions; // if no dimensions provided, will be undefined/not sent to OpenAI\n        this.embedBatchSize = init?.embedBatchSize ?? 10;\n        this.maxRetries = init?.maxRetries ?? 10;\n        this.timeout = init?.timeout ?? 60 * 1000; // Default is 60 seconds\n        this.additionalSessionOptions = init?.additionalSessionOptions;\n        // find metadata for model\n        const key = Object.keys(ALL_OPENAI_EMBEDDING_MODELS).find((key)=>key === this.model);\n        if (key) {\n            this.embedInfo = ALL_OPENAI_EMBEDDING_MODELS[key];\n        }\n        if (init?.azure || shouldUseAzure()) {\n            const azureConfig = {\n                ...getAzureConfigFromEnv({\n                    model: getAzureModel(this.model)\n                }),\n                ...init?.azure\n            };\n            this.apiKey = init?.session?.apiKey ?? azureConfig.apiKey ?? getEnv(\"OPENAI_API_KEY\");\n            this.baseURL = init?.session?.baseURL ?? azureConfig.baseURL ?? getEnv(\"OPENAI_BASE_URL\");\n            this.lazySession = async ()=>import('openai').then(async ({ AzureOpenAI })=>{\n                    AzureOpenAI = AzureOpenAIWithUserAgent(AzureOpenAI);\n                    return init?.session ?? new AzureOpenAI({\n                        maxRetries: this.maxRetries,\n                        timeout: this.timeout,\n                        ...this.additionalSessionOptions,\n                        ...azureConfig\n                    });\n                });\n        } else {\n            this.apiKey = init?.session?.apiKey ?? init?.apiKey ?? getEnv(\"OPENAI_API_KEY\");\n            this.baseURL = init?.session?.baseURL ?? init?.baseURL ?? getEnv(\"OPENAI_BASE_URL\");\n            this.lazySession = async ()=>import('openai').then(({ OpenAI })=>{\n                    return init?.session ?? new OpenAI({\n                        apiKey: this.apiKey,\n                        baseURL: this.baseURL,\n                        maxRetries: this.maxRetries,\n                        timeout: this.timeout,\n                        ...this.additionalSessionOptions\n                    });\n                });\n        }\n    }\n    /**\n   * Get embeddings for a batch of texts\n   * @param texts\n   * @param options\n   */ async getOpenAIEmbedding(input) {\n        // TODO: ensure this for every sub class by calling it in the base class\n        input = this.truncateMaxTokens(input);\n        const { data } = await (await this.session).embeddings.create(this.dimensions ? {\n            model: this.model,\n            dimensions: this.dimensions,\n            input\n        } : {\n            model: this.model,\n            input\n        });\n        return data.map((d)=>d.embedding);\n    }\n    /**\n   * Get embeddings for a single text\n   * @param text\n   */ async getTextEmbedding(text) {\n        return (await this.getOpenAIEmbedding([\n            text\n        ]))[0];\n    }\n}\n\nexport { ALL_AVAILABLE_OPENAI_MODELS, ALL_OPENAI_EMBEDDING_MODELS, GPT35_MODELS, GPT4_MODELS, O1_MODELS, O3_MODELS, OpenAI, OpenAIAgent, OpenAIAgentWorker, OpenAIEmbedding, openai };\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1364, "column": 0}, "map": {"version":3,"sources":["file:///C:/app/agentset/node_modules/%40llamaindex/workflow/dist/index.js"],"sourcesContent":["import { randomUUID, CustomEvent } from '@llamaindex/env';\n\nclass WorkflowEvent {\n    constructor(data){\n        this.data = data;\n        this.displayName = this.constructor.name;\n    }\n    toString() {\n        return this.displayName;\n    }\n    static or(AEvent, BEvent) {\n        function OrEvent() {\n            throw new Error(\"Cannot instantiate OrEvent\");\n        }\n        OrEvent.prototype = Object.create(AEvent.prototype);\n        Object.getOwnPropertyNames(BEvent.prototype).forEach((property)=>{\n            if (!(property in OrEvent.prototype)) {\n                Object.defineProperty(OrEvent.prototype, property, Object.getOwnPropertyDescriptor(BEvent.prototype, property));\n            }\n        });\n        OrEvent.prototype.constructor = OrEvent;\n        Object.defineProperty(OrEvent, Symbol.hasInstance, {\n            value: function(instance) {\n                return instance instanceof AEvent || instance instanceof BEvent;\n            }\n        });\n        return OrEvent;\n    }\n}\n// These are special events that are used to control the workflow\nclass StartEvent extends WorkflowEvent {\n    constructor(data){\n        super(data);\n    }\n}\nclass StopEvent extends WorkflowEvent {\n    constructor(data){\n        super(data);\n    }\n}\n\nvar _computedKey, _computedKey1;\nfunction flattenEvents(acceptEventTypes, inputEvents) {\n    const eventMap = new Map();\n    for (const event of inputEvents){\n        for (const acceptType of acceptEventTypes){\n            if (event instanceof acceptType && !eventMap.has(acceptType)) {\n                eventMap.set(acceptType, event);\n                break; // Once matched, no need to check other accept types\n            }\n        }\n    }\n    return Array.from(eventMap.values());\n}\n_computedKey = Symbol.asyncIterator, _computedKey1 = Symbol.toStringTag;\nclass WorkflowContext {\n    #steps;\n    #startEvent;\n    #queue;\n    #queueEventTarget;\n    #wait;\n    #timeout;\n    #verbose;\n    #data;\n    #stepCache;\n    #getStepFunction(event) {\n        if (this.#stepCache.has(event)) {\n            return this.#stepCache.get(event);\n        }\n        const set = new Set();\n        const stepInputs = new WeakMap();\n        const stepOutputs = new WeakMap();\n        const res = [\n            set,\n            stepInputs,\n            stepOutputs\n        ];\n        this.#stepCache.set(event, res);\n        for (const [step, { inputs, outputs }] of this.#steps){\n            if (inputs.some((input)=>event instanceof input)) {\n                set.add(step);\n                stepInputs.set(step, inputs);\n                stepOutputs.set(step, outputs);\n            }\n        }\n        return res;\n    }\n    constructor(params){\n        this.#queue = [];\n        this.#queueEventTarget = new EventTarget();\n        this.#timeout = null;\n        this.#verbose = false;\n        this.#stepCache = new Map();\n        // make sure it will only be called once\n        this.#iterator = null;\n        this.#signal = null;\n        this.#sendEvent = (event)=>{\n            this.#queue.push({\n                type: \"event\",\n                event\n            });\n        };\n        this.#requireEvent = async (event)=>{\n            const requestId = randomUUID();\n            this.#queue.push({\n                type: \"requestEvent\",\n                id: requestId,\n                requestEvent: event\n            });\n            return new Promise((resolve)=>{\n                const handler = (event)=>{\n                    if (event instanceof CustomEvent) {\n                        const { id } = event.detail;\n                        if (requestId === id) {\n                            this.#queueEventTarget.removeEventListener(\"update\", handler);\n                            resolve(event.detail.event);\n                        }\n                    }\n                };\n                this.#queueEventTarget.addEventListener(\"update\", handler);\n            });\n        };\n        this.#pendingInputQueue = [];\n        // if strict mode is enabled, it will throw an error if there's input or output events are not expected\n        this.#strict = false;\n        // PromiseLike implementation, this is following the Promise/A+ spec\n        // It will consume the iterator and resolve the promise once it reaches the StopEvent\n        // If you want to customize the behavior, you can use the async iterator directly\n        this.#resolved = null;\n        this.#rejected = null;\n        this[_computedKey1] = \"Context\";\n        this.#steps = params.steps;\n        this.#startEvent = params.startEvent;\n        if (typeof params.timeout === \"number\") {\n            this.#timeout = params.timeout;\n        }\n        this.#data = params.contextData;\n        this.#verbose = params.verbose ?? false;\n        this.#wait = params.wait;\n        // push start event to the queue\n        const [step] = this.#getStepFunction(this.#startEvent);\n        if (step.size === 0) {\n            throw new TypeError(\"No step found for start event\");\n        }\n        // restore from snapshot\n        if (params.queue) {\n            params.queue.forEach((protocol)=>{\n                this.#queue.push(protocol);\n            });\n        } else {\n            this.#sendEvent(this.#startEvent);\n        }\n        if (params.pendingInputQueue) {\n            this.#pendingInputQueue = params.pendingInputQueue;\n        }\n        if (params.resolved) {\n            this.#resolved = params.resolved;\n        }\n        if (params.rejected) {\n            this.#rejected = params.rejected;\n        }\n    }\n    #iterator;\n    #signal;\n    get #iteratorSingleton() {\n        if (this.#iterator === null) {\n            this.#iterator = this.#createStreamEvents();\n        }\n        return this.#iterator;\n    }\n    [_computedKey]() {\n        return this.#iteratorSingleton;\n    }\n    #sendEvent;\n    #requireEvent;\n    #pendingInputQueue;\n    #strict;\n    strict() {\n        this.#strict = true;\n        return this;\n    }\n    get data() {\n        return this.#data;\n    }\n    /**\n   * Stream events from the start event\n   *\n   * Note that this function will stop once there's no more future events,\n   *  if you want stop immediately once reach a StopEvent, you should handle it in the other side.\n   * @private\n   */ #createStreamEvents() {\n        const isPendingEvents = new WeakSet();\n        const pendingTasks = new Set();\n        const enqueuedEvents = new Set();\n        const stream = new ReadableStream({\n            start: async (controller)=>{\n                while(true){\n                    const eventProtocol = this.#queue.shift();\n                    if (eventProtocol) {\n                        switch(eventProtocol.type){\n                            case \"requestEvent\":\n                                {\n                                    const { id, requestEvent } = eventProtocol;\n                                    const acceptableInput = this.#pendingInputQueue.find((event)=>event instanceof requestEvent);\n                                    if (acceptableInput) {\n                                        // remove the event from the queue, in case of infinite loop\n                                        const protocolIdx = this.#queue.findIndex((protocol)=>protocol.type === \"event\" && protocol.event === acceptableInput);\n                                        if (protocolIdx !== -1) {\n                                            this.#queue.splice(protocolIdx, 1);\n                                        }\n                                        this.#pendingInputQueue.splice(this.#pendingInputQueue.indexOf(acceptableInput), 1);\n                                        this.#queueEventTarget.dispatchEvent(new CustomEvent(\"update\", {\n                                            detail: {\n                                                id,\n                                                event: acceptableInput\n                                            }\n                                        }));\n                                    } else {\n                                        // push back to the queue as there are not enough events\n                                        this.#queue.push(eventProtocol);\n                                    }\n                                    break;\n                                }\n                            case \"event\":\n                                {\n                                    const { event } = eventProtocol;\n                                    if (isPendingEvents.has(event)) {\n                                        // this event is still processing\n                                        this.#sendEvent(event);\n                                    } else {\n                                        if (!enqueuedEvents.has(event)) {\n                                            controller.enqueue(event);\n                                            enqueuedEvents.add(event);\n                                        }\n                                        const [steps, inputsMap, outputsMap] = this.#getStepFunction(event);\n                                        const nextEventPromises = [\n                                            ...steps\n                                        ].map((step)=>{\n                                            const inputs = [\n                                                ...inputsMap.get(step) ?? []\n                                            ];\n                                            const acceptableInputs = this.#pendingInputQueue.filter((event)=>inputs.some((input)=>event instanceof input));\n                                            const events = flattenEvents(inputs, [\n                                                event,\n                                                ...acceptableInputs\n                                            ]);\n                                            // remove the event from the queue, in case of infinite loop\n                                            events.forEach((event)=>{\n                                                const protocolIdx = this.#queue.findIndex((protocol)=>protocol.type === \"event\" && protocol.event === event);\n                                                if (protocolIdx !== -1) {\n                                                    this.#queue.splice(protocolIdx, 1);\n                                                }\n                                            });\n                                            if (events.length !== inputs.length) {\n                                                if (this.#verbose) {\n                                                    console.log(`Not enough inputs for step ${step.name}, waiting for more events`);\n                                                }\n                                                // not enough to run the step, push back to the queue\n                                                this.#sendEvent(event);\n                                                isPendingEvents.add(event);\n                                                return null;\n                                            }\n                                            if (isPendingEvents.has(event)) {\n                                                isPendingEvents.delete(event);\n                                            }\n                                            if (this.#verbose) {\n                                                console.log(`Running step ${step.name} with inputs ${events}`);\n                                            }\n                                            const data = this.data;\n                                            return step.call(null, {\n                                                get data () {\n                                                    return data;\n                                                },\n                                                sendEvent: this.#sendEvent,\n                                                requireEvent: this.#requireEvent\n                                            }, // @ts-expect-error IDK why\n                                            ...events.sort((a, b)=>{\n                                                const aIndex = inputs.indexOf(a.constructor);\n                                                const bIndex = inputs.indexOf(b.constructor);\n                                                return aIndex - bIndex;\n                                            })).then((nextEvent)=>{\n                                                if (nextEvent === undefined) {\n                                                    return;\n                                                }\n                                                if (this.#verbose) {\n                                                    console.log(`Step ${step.name} completed, next event is ${nextEvent}`);\n                                                }\n                                                const outputs = outputsMap.get(step) ?? [];\n                                                if (!outputs.some((output)=>nextEvent.constructor === output)) {\n                                                    if (this.#strict) {\n                                                        const error = Error(`Step ${step.name} returned an unexpected output event ${nextEvent}`);\n                                                        controller.error(error);\n                                                    } else {\n                                                        console.warn(`Step ${step.name} returned an unexpected output event ${nextEvent}`);\n                                                    }\n                                                }\n                                                if (!(nextEvent instanceof StopEvent)) {\n                                                    this.#pendingInputQueue.unshift(nextEvent);\n                                                    this.#sendEvent(nextEvent);\n                                                }\n                                                return nextEvent;\n                                            });\n                                        }).filter((promise)=>promise !== null);\n                                        nextEventPromises.forEach((promise)=>{\n                                            pendingTasks.add(promise);\n                                            promise.catch((err)=>{\n                                                console.error(\"Error in step\", err);\n                                            }).finally(()=>{\n                                                pendingTasks.delete(promise);\n                                            });\n                                        });\n                                        Promise.race(nextEventPromises).then((fastestNextEvent)=>{\n                                            if (fastestNextEvent === undefined) {\n                                                return;\n                                            }\n                                            if (!enqueuedEvents.has(fastestNextEvent)) {\n                                                controller.enqueue(fastestNextEvent);\n                                                enqueuedEvents.add(fastestNextEvent);\n                                            }\n                                            return fastestNextEvent;\n                                        }).then(async (fastestNextEvent)=>Promise.all(nextEventPromises).then((nextEvents)=>{\n                                                const events = nextEvents.filter((event)=>event !== undefined);\n                                                for (const nextEvent of events){\n                                                    // do not enqueue the same event twice\n                                                    if (fastestNextEvent !== nextEvent) {\n                                                        if (!enqueuedEvents.has(nextEvent)) {\n                                                            controller.enqueue(nextEvent);\n                                                            enqueuedEvents.add(nextEvent);\n                                                        }\n                                                    }\n                                                }\n                                            })).catch((err)=>{\n                                            // when the step raise an error, should go back to the previous step\n                                            this.#sendEvent(event);\n                                            isPendingEvents.add(event);\n                                            controller.error(err);\n                                        });\n                                    }\n                                    break;\n                                }\n                        }\n                    }\n                    if (this.#queue.length === 0 && pendingTasks.size === 0) {\n                        if (this.#verbose) {\n                            console.log(\"No more events in the queue\");\n                        }\n                        break;\n                    }\n                    await this.#wait();\n                }\n                controller.close();\n            }\n        });\n        return stream[Symbol.asyncIterator]();\n    }\n    with(data) {\n        return new WorkflowContext({\n            startEvent: this.#startEvent,\n            wait: this.#wait,\n            contextData: data,\n            steps: this.#steps,\n            timeout: this.#timeout,\n            verbose: this.#verbose,\n            queue: this.#queue,\n            pendingInputQueue: this.#pendingInputQueue,\n            resolved: this.#resolved,\n            rejected: this.#rejected\n        });\n    }\n    #resolved;\n    #rejected;\n    async then(onfulfilled, onrejected) {\n        onfulfilled ??= (value)=>value;\n        onrejected ??= (reason)=>{\n            throw reason;\n        };\n        if (this.#resolved !== null) {\n            return Promise.resolve(this.#resolved).then(onfulfilled, onrejected);\n        } else if (this.#rejected !== null) {\n            return Promise.reject(this.#rejected).then(onfulfilled, onrejected);\n        }\n        if (this.#timeout !== null) {\n            const timeout = this.#timeout;\n            this.#signal = AbortSignal.timeout(timeout * 1000);\n        }\n        this.#signal?.addEventListener(\"abort\", ()=>{\n            this.#rejected = new Error(`Operation timed out after ${this.#timeout} seconds`);\n            onrejected?.(this.#rejected);\n        });\n        try {\n            for await (const event of this.#iteratorSingleton){\n                if (this.#rejected !== null) {\n                    return onrejected?.(this.#rejected);\n                }\n                if (event instanceof StartEvent) {\n                    if (this.#verbose) {\n                        console.log(`Starting workflow with event ${event}`);\n                    }\n                }\n                if (event instanceof StopEvent) {\n                    if (this.#verbose && this.#pendingInputQueue.length > 0) {\n                    // fixme: #pendingInputQueue might should be cleanup correctly?\n                    }\n                    this.#resolved = event;\n                    return onfulfilled?.(event);\n                }\n            }\n        } catch (err) {\n            if (err instanceof Error) {\n                this.#rejected = err;\n            }\n            return onrejected?.(err);\n        }\n        const nextValue = await this.#iteratorSingleton.next();\n        if (nextValue.done === false) {\n            this.#rejected = new Error(\"Workflow did not complete\");\n            return onrejected?.(this.#rejected);\n        }\n        return onrejected?.(new Error(\"UNREACHABLE\"));\n    }\n    catch(onrejected) {\n        return this.then((v)=>v, onrejected);\n    }\n    finally(onfinally) {\n        return this.then(()=>{\n            onfinally?.();\n        }, ()=>{\n            onfinally?.();\n        });\n    }\n    // for worker thread\n    snapshot() {\n        const state = {\n            startEvent: this.#startEvent,\n            queue: this.#queue,\n            pendingInputQueue: this.#pendingInputQueue,\n            data: this.#data,\n            timeout: this.#timeout,\n            verbose: this.#verbose,\n            resolved: this.#resolved,\n            rejected: this.#rejected\n        };\n        const jsonString = JSON.stringify(state, (_, value)=>{\n            // If value is an instance of a class, serialize only its properties\n            if (value instanceof WorkflowEvent) {\n                return {\n                    data: value.data,\n                    constructor: value.constructor.name\n                };\n            }\n            // value is Subtype of WorkflowEvent\n            if (typeof value === \"object\" && value !== null && value?.prototype instanceof WorkflowEvent) {\n                return {\n                    constructor: value.prototype.constructor.name\n                };\n            }\n            return value;\n        });\n        return new TextEncoder().encode(jsonString).buffer;\n    }\n}\n\nclass Workflow {\n    #steps;\n    #verbose;\n    #timeout;\n    // fixme: allow microtask\n    #nextTick;\n    constructor(params = {}){\n        this.#steps = new Map();\n        this.#verbose = false;\n        this.#timeout = null;\n        this.#nextTick = ()=>new Promise((resolve)=>setTimeout(resolve, 0));\n        if (params.verbose) {\n            this.#verbose = params.verbose;\n        }\n        if (params.timeout) {\n            this.#timeout = params.timeout;\n        }\n        if (params.wait) {\n            this.#nextTick = params.wait;\n        }\n    }\n    addStep(parameters, stepFn) {\n        const { inputs, outputs } = parameters;\n        this.#steps.set(stepFn, {\n            inputs,\n            outputs\n        });\n        return this;\n    }\n    hasStep(stepFn) {\n        return this.#steps.has(stepFn);\n    }\n    removeStep(stepFn) {\n        this.#steps.delete(stepFn);\n        return this;\n    }\n    run(event, data) {\n        const startEvent = event instanceof StartEvent ? event : new StartEvent(event);\n        return new WorkflowContext({\n            startEvent,\n            wait: this.#nextTick,\n            contextData: data,\n            steps: new Map(this.#steps),\n            timeout: this.#timeout,\n            verbose: this.#verbose,\n            queue: undefined,\n            pendingInputQueue: undefined,\n            resolved: null,\n            rejected: null\n        });\n    }\n    recover(data) {\n        const jsonString = new TextDecoder().decode(data);\n        const state = JSON.parse(jsonString);\n        const reconstructedStartEvent = new StartEvent(state.startEvent);\n        const AllEvents = [\n            ...this.#steps\n        ].map(([, { inputs, outputs }])=>[\n                ...inputs,\n                ...outputs ?? []\n            ]).flat();\n        const reconstructedQueue = state.queue.map((protocol)=>{\n            switch(protocol.type){\n                case \"requestEvent\":\n                    {\n                        const { requestEvent, id } = protocol;\n                        const EventType = AllEvents.find((type)=>type.prototype.constructor.name === requestEvent.constructor);\n                        if (!EventType) {\n                            throw new TypeError(`Event type not found: ${requestEvent.constructor}`);\n                        }\n                        return {\n                            type: \"requestEvent\",\n                            id,\n                            requestEvent: EventType\n                        };\n                    }\n                case \"event\":\n                    {\n                        const { event } = protocol;\n                        const EventType = AllEvents.find((type)=>type.prototype.constructor.name === event.constructor);\n                        if (!EventType) {\n                            throw new TypeError(`Event type not found: ${event.constructor}`);\n                        }\n                        return {\n                            type: \"event\",\n                            event: new EventType(event.data)\n                        };\n                    }\n            }\n        });\n        const reconstructedPendingInputQueue = state.pendingInputQueue.map((event)=>{\n            const EventType = AllEvents.find((type)=>type.prototype.constructor.name === event.constructor);\n            if (!EventType) {\n                throw new TypeError(`Event type not found: ${event.constructor}`);\n            }\n            return new EventType(event.data);\n        });\n        return new WorkflowContext({\n            startEvent: reconstructedStartEvent,\n            contextData: state.data,\n            wait: this.#nextTick,\n            steps: this.#steps,\n            timeout: state.timeout,\n            verbose: state.verbose,\n            queue: reconstructedQueue,\n            pendingInputQueue: reconstructedPendingInputQueue,\n            resolved: state.resolved ? new StopEvent(state.resolved) : null,\n            rejected: state.rejected ? new Error(state.rejected) : null\n        });\n    }\n}\n\nexport { StartEvent, StopEvent, Workflow, WorkflowContext, WorkflowEvent };\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1950, "column": 0}, "map": {"version":3,"sources":["file:///C:/app/agentset/node_modules/%40llamaindex/workflow/dist/agent/index.js"],"sourcesContent":["import { ChatMemoryBuffer } from '@llamaindex/core/memory';\nimport { PromptTemplate } from '@llamaindex/core/prompts';\nimport { FunctionTool } from '@llamaindex/core/tools';\nimport { stringifyJSONToMessageContent } from '@llamaindex/core/utils';\nimport { z } from 'zod';\nimport { randomUUID, CustomEvent } from '@llamaindex/env';\nimport { Settings } from '@llamaindex/core/global';\n\nclass WorkflowEvent {\n    constructor(data){\n        this.data = data;\n        this.displayName = this.constructor.name;\n    }\n    toString() {\n        return this.displayName;\n    }\n    static or(AEvent, BEvent) {\n        function OrEvent() {\n            throw new Error(\"Cannot instantiate OrEvent\");\n        }\n        OrEvent.prototype = Object.create(AEvent.prototype);\n        Object.getOwnPropertyNames(BEvent.prototype).forEach((property)=>{\n            if (!(property in OrEvent.prototype)) {\n                Object.defineProperty(OrEvent.prototype, property, Object.getOwnPropertyDescriptor(BEvent.prototype, property));\n            }\n        });\n        OrEvent.prototype.constructor = OrEvent;\n        Object.defineProperty(OrEvent, Symbol.hasInstance, {\n            value: function(instance) {\n                return instance instanceof AEvent || instance instanceof BEvent;\n            }\n        });\n        return OrEvent;\n    }\n}\n// These are special events that are used to control the workflow\nclass StartEvent extends WorkflowEvent {\n    constructor(data){\n        super(data);\n    }\n}\nclass StopEvent extends WorkflowEvent {\n    constructor(data){\n        super(data);\n    }\n}\n\nvar _computedKey, _computedKey1;\nfunction flattenEvents(acceptEventTypes, inputEvents) {\n    const eventMap = new Map();\n    for (const event of inputEvents){\n        for (const acceptType of acceptEventTypes){\n            if (event instanceof acceptType && !eventMap.has(acceptType)) {\n                eventMap.set(acceptType, event);\n                break; // Once matched, no need to check other accept types\n            }\n        }\n    }\n    return Array.from(eventMap.values());\n}\n_computedKey = Symbol.asyncIterator, _computedKey1 = Symbol.toStringTag;\nclass WorkflowContext {\n    #steps;\n    #startEvent;\n    #queue;\n    #queueEventTarget;\n    #wait;\n    #timeout;\n    #verbose;\n    #data;\n    #stepCache;\n    #getStepFunction(event) {\n        if (this.#stepCache.has(event)) {\n            return this.#stepCache.get(event);\n        }\n        const set = new Set();\n        const stepInputs = new WeakMap();\n        const stepOutputs = new WeakMap();\n        const res = [\n            set,\n            stepInputs,\n            stepOutputs\n        ];\n        this.#stepCache.set(event, res);\n        for (const [step, { inputs, outputs }] of this.#steps){\n            if (inputs.some((input)=>event instanceof input)) {\n                set.add(step);\n                stepInputs.set(step, inputs);\n                stepOutputs.set(step, outputs);\n            }\n        }\n        return res;\n    }\n    constructor(params){\n        this.#queue = [];\n        this.#queueEventTarget = new EventTarget();\n        this.#timeout = null;\n        this.#verbose = false;\n        this.#stepCache = new Map();\n        // make sure it will only be called once\n        this.#iterator = null;\n        this.#signal = null;\n        this.#sendEvent = (event)=>{\n            this.#queue.push({\n                type: \"event\",\n                event\n            });\n        };\n        this.#requireEvent = async (event)=>{\n            const requestId = randomUUID();\n            this.#queue.push({\n                type: \"requestEvent\",\n                id: requestId,\n                requestEvent: event\n            });\n            return new Promise((resolve)=>{\n                const handler = (event)=>{\n                    if (event instanceof CustomEvent) {\n                        const { id } = event.detail;\n                        if (requestId === id) {\n                            this.#queueEventTarget.removeEventListener(\"update\", handler);\n                            resolve(event.detail.event);\n                        }\n                    }\n                };\n                this.#queueEventTarget.addEventListener(\"update\", handler);\n            });\n        };\n        this.#pendingInputQueue = [];\n        // if strict mode is enabled, it will throw an error if there's input or output events are not expected\n        this.#strict = false;\n        // PromiseLike implementation, this is following the Promise/A+ spec\n        // It will consume the iterator and resolve the promise once it reaches the StopEvent\n        // If you want to customize the behavior, you can use the async iterator directly\n        this.#resolved = null;\n        this.#rejected = null;\n        this[_computedKey1] = \"Context\";\n        this.#steps = params.steps;\n        this.#startEvent = params.startEvent;\n        if (typeof params.timeout === \"number\") {\n            this.#timeout = params.timeout;\n        }\n        this.#data = params.contextData;\n        this.#verbose = params.verbose ?? false;\n        this.#wait = params.wait;\n        // push start event to the queue\n        const [step] = this.#getStepFunction(this.#startEvent);\n        if (step.size === 0) {\n            throw new TypeError(\"No step found for start event\");\n        }\n        // restore from snapshot\n        if (params.queue) {\n            params.queue.forEach((protocol)=>{\n                this.#queue.push(protocol);\n            });\n        } else {\n            this.#sendEvent(this.#startEvent);\n        }\n        if (params.pendingInputQueue) {\n            this.#pendingInputQueue = params.pendingInputQueue;\n        }\n        if (params.resolved) {\n            this.#resolved = params.resolved;\n        }\n        if (params.rejected) {\n            this.#rejected = params.rejected;\n        }\n    }\n    #iterator;\n    #signal;\n    get #iteratorSingleton() {\n        if (this.#iterator === null) {\n            this.#iterator = this.#createStreamEvents();\n        }\n        return this.#iterator;\n    }\n    [_computedKey]() {\n        return this.#iteratorSingleton;\n    }\n    #sendEvent;\n    #requireEvent;\n    #pendingInputQueue;\n    #strict;\n    strict() {\n        this.#strict = true;\n        return this;\n    }\n    get data() {\n        return this.#data;\n    }\n    /**\n   * Stream events from the start event\n   *\n   * Note that this function will stop once there's no more future events,\n   *  if you want stop immediately once reach a StopEvent, you should handle it in the other side.\n   * @private\n   */ #createStreamEvents() {\n        const isPendingEvents = new WeakSet();\n        const pendingTasks = new Set();\n        const enqueuedEvents = new Set();\n        const stream = new ReadableStream({\n            start: async (controller)=>{\n                while(true){\n                    const eventProtocol = this.#queue.shift();\n                    if (eventProtocol) {\n                        switch(eventProtocol.type){\n                            case \"requestEvent\":\n                                {\n                                    const { id, requestEvent } = eventProtocol;\n                                    const acceptableInput = this.#pendingInputQueue.find((event)=>event instanceof requestEvent);\n                                    if (acceptableInput) {\n                                        // remove the event from the queue, in case of infinite loop\n                                        const protocolIdx = this.#queue.findIndex((protocol)=>protocol.type === \"event\" && protocol.event === acceptableInput);\n                                        if (protocolIdx !== -1) {\n                                            this.#queue.splice(protocolIdx, 1);\n                                        }\n                                        this.#pendingInputQueue.splice(this.#pendingInputQueue.indexOf(acceptableInput), 1);\n                                        this.#queueEventTarget.dispatchEvent(new CustomEvent(\"update\", {\n                                            detail: {\n                                                id,\n                                                event: acceptableInput\n                                            }\n                                        }));\n                                    } else {\n                                        // push back to the queue as there are not enough events\n                                        this.#queue.push(eventProtocol);\n                                    }\n                                    break;\n                                }\n                            case \"event\":\n                                {\n                                    const { event } = eventProtocol;\n                                    if (isPendingEvents.has(event)) {\n                                        // this event is still processing\n                                        this.#sendEvent(event);\n                                    } else {\n                                        if (!enqueuedEvents.has(event)) {\n                                            controller.enqueue(event);\n                                            enqueuedEvents.add(event);\n                                        }\n                                        const [steps, inputsMap, outputsMap] = this.#getStepFunction(event);\n                                        const nextEventPromises = [\n                                            ...steps\n                                        ].map((step)=>{\n                                            const inputs = [\n                                                ...inputsMap.get(step) ?? []\n                                            ];\n                                            const acceptableInputs = this.#pendingInputQueue.filter((event)=>inputs.some((input)=>event instanceof input));\n                                            const events = flattenEvents(inputs, [\n                                                event,\n                                                ...acceptableInputs\n                                            ]);\n                                            // remove the event from the queue, in case of infinite loop\n                                            events.forEach((event)=>{\n                                                const protocolIdx = this.#queue.findIndex((protocol)=>protocol.type === \"event\" && protocol.event === event);\n                                                if (protocolIdx !== -1) {\n                                                    this.#queue.splice(protocolIdx, 1);\n                                                }\n                                            });\n                                            if (events.length !== inputs.length) {\n                                                if (this.#verbose) {\n                                                    console.log(`Not enough inputs for step ${step.name}, waiting for more events`);\n                                                }\n                                                // not enough to run the step, push back to the queue\n                                                this.#sendEvent(event);\n                                                isPendingEvents.add(event);\n                                                return null;\n                                            }\n                                            if (isPendingEvents.has(event)) {\n                                                isPendingEvents.delete(event);\n                                            }\n                                            if (this.#verbose) {\n                                                console.log(`Running step ${step.name} with inputs ${events}`);\n                                            }\n                                            const data = this.data;\n                                            return step.call(null, {\n                                                get data () {\n                                                    return data;\n                                                },\n                                                sendEvent: this.#sendEvent,\n                                                requireEvent: this.#requireEvent\n                                            }, // @ts-expect-error IDK why\n                                            ...events.sort((a, b)=>{\n                                                const aIndex = inputs.indexOf(a.constructor);\n                                                const bIndex = inputs.indexOf(b.constructor);\n                                                return aIndex - bIndex;\n                                            })).then((nextEvent)=>{\n                                                if (nextEvent === undefined) {\n                                                    return;\n                                                }\n                                                if (this.#verbose) {\n                                                    console.log(`Step ${step.name} completed, next event is ${nextEvent}`);\n                                                }\n                                                const outputs = outputsMap.get(step) ?? [];\n                                                if (!outputs.some((output)=>nextEvent.constructor === output)) {\n                                                    if (this.#strict) {\n                                                        const error = Error(`Step ${step.name} returned an unexpected output event ${nextEvent}`);\n                                                        controller.error(error);\n                                                    } else {\n                                                        console.warn(`Step ${step.name} returned an unexpected output event ${nextEvent}`);\n                                                    }\n                                                }\n                                                if (!(nextEvent instanceof StopEvent)) {\n                                                    this.#pendingInputQueue.unshift(nextEvent);\n                                                    this.#sendEvent(nextEvent);\n                                                }\n                                                return nextEvent;\n                                            });\n                                        }).filter((promise)=>promise !== null);\n                                        nextEventPromises.forEach((promise)=>{\n                                            pendingTasks.add(promise);\n                                            promise.catch((err)=>{\n                                                console.error(\"Error in step\", err);\n                                            }).finally(()=>{\n                                                pendingTasks.delete(promise);\n                                            });\n                                        });\n                                        Promise.race(nextEventPromises).then((fastestNextEvent)=>{\n                                            if (fastestNextEvent === undefined) {\n                                                return;\n                                            }\n                                            if (!enqueuedEvents.has(fastestNextEvent)) {\n                                                controller.enqueue(fastestNextEvent);\n                                                enqueuedEvents.add(fastestNextEvent);\n                                            }\n                                            return fastestNextEvent;\n                                        }).then(async (fastestNextEvent)=>Promise.all(nextEventPromises).then((nextEvents)=>{\n                                                const events = nextEvents.filter((event)=>event !== undefined);\n                                                for (const nextEvent of events){\n                                                    // do not enqueue the same event twice\n                                                    if (fastestNextEvent !== nextEvent) {\n                                                        if (!enqueuedEvents.has(nextEvent)) {\n                                                            controller.enqueue(nextEvent);\n                                                            enqueuedEvents.add(nextEvent);\n                                                        }\n                                                    }\n                                                }\n                                            })).catch((err)=>{\n                                            // when the step raise an error, should go back to the previous step\n                                            this.#sendEvent(event);\n                                            isPendingEvents.add(event);\n                                            controller.error(err);\n                                        });\n                                    }\n                                    break;\n                                }\n                        }\n                    }\n                    if (this.#queue.length === 0 && pendingTasks.size === 0) {\n                        if (this.#verbose) {\n                            console.log(\"No more events in the queue\");\n                        }\n                        break;\n                    }\n                    await this.#wait();\n                }\n                controller.close();\n            }\n        });\n        return stream[Symbol.asyncIterator]();\n    }\n    with(data) {\n        return new WorkflowContext({\n            startEvent: this.#startEvent,\n            wait: this.#wait,\n            contextData: data,\n            steps: this.#steps,\n            timeout: this.#timeout,\n            verbose: this.#verbose,\n            queue: this.#queue,\n            pendingInputQueue: this.#pendingInputQueue,\n            resolved: this.#resolved,\n            rejected: this.#rejected\n        });\n    }\n    #resolved;\n    #rejected;\n    async then(onfulfilled, onrejected) {\n        onfulfilled ??= (value)=>value;\n        onrejected ??= (reason)=>{\n            throw reason;\n        };\n        if (this.#resolved !== null) {\n            return Promise.resolve(this.#resolved).then(onfulfilled, onrejected);\n        } else if (this.#rejected !== null) {\n            return Promise.reject(this.#rejected).then(onfulfilled, onrejected);\n        }\n        if (this.#timeout !== null) {\n            const timeout = this.#timeout;\n            this.#signal = AbortSignal.timeout(timeout * 1000);\n        }\n        this.#signal?.addEventListener(\"abort\", ()=>{\n            this.#rejected = new Error(`Operation timed out after ${this.#timeout} seconds`);\n            onrejected?.(this.#rejected);\n        });\n        try {\n            for await (const event of this.#iteratorSingleton){\n                if (this.#rejected !== null) {\n                    return onrejected?.(this.#rejected);\n                }\n                if (event instanceof StartEvent) {\n                    if (this.#verbose) {\n                        console.log(`Starting workflow with event ${event}`);\n                    }\n                }\n                if (event instanceof StopEvent) {\n                    if (this.#verbose && this.#pendingInputQueue.length > 0) {\n                    // fixme: #pendingInputQueue might should be cleanup correctly?\n                    }\n                    this.#resolved = event;\n                    return onfulfilled?.(event);\n                }\n            }\n        } catch (err) {\n            if (err instanceof Error) {\n                this.#rejected = err;\n            }\n            return onrejected?.(err);\n        }\n        const nextValue = await this.#iteratorSingleton.next();\n        if (nextValue.done === false) {\n            this.#rejected = new Error(\"Workflow did not complete\");\n            return onrejected?.(this.#rejected);\n        }\n        return onrejected?.(new Error(\"UNREACHABLE\"));\n    }\n    catch(onrejected) {\n        return this.then((v)=>v, onrejected);\n    }\n    finally(onfinally) {\n        return this.then(()=>{\n            onfinally?.();\n        }, ()=>{\n            onfinally?.();\n        });\n    }\n    // for worker thread\n    snapshot() {\n        const state = {\n            startEvent: this.#startEvent,\n            queue: this.#queue,\n            pendingInputQueue: this.#pendingInputQueue,\n            data: this.#data,\n            timeout: this.#timeout,\n            verbose: this.#verbose,\n            resolved: this.#resolved,\n            rejected: this.#rejected\n        };\n        const jsonString = JSON.stringify(state, (_, value)=>{\n            // If value is an instance of a class, serialize only its properties\n            if (value instanceof WorkflowEvent) {\n                return {\n                    data: value.data,\n                    constructor: value.constructor.name\n                };\n            }\n            // value is Subtype of WorkflowEvent\n            if (typeof value === \"object\" && value !== null && value?.prototype instanceof WorkflowEvent) {\n                return {\n                    constructor: value.prototype.constructor.name\n                };\n            }\n            return value;\n        });\n        return new TextEncoder().encode(jsonString).buffer;\n    }\n}\n\nclass Workflow {\n    #steps;\n    #verbose;\n    #timeout;\n    // fixme: allow microtask\n    #nextTick;\n    constructor(params = {}){\n        this.#steps = new Map();\n        this.#verbose = false;\n        this.#timeout = null;\n        this.#nextTick = ()=>new Promise((resolve)=>setTimeout(resolve, 0));\n        if (params.verbose) {\n            this.#verbose = params.verbose;\n        }\n        if (params.timeout) {\n            this.#timeout = params.timeout;\n        }\n        if (params.wait) {\n            this.#nextTick = params.wait;\n        }\n    }\n    addStep(parameters, stepFn) {\n        const { inputs, outputs } = parameters;\n        this.#steps.set(stepFn, {\n            inputs,\n            outputs\n        });\n        return this;\n    }\n    hasStep(stepFn) {\n        return this.#steps.has(stepFn);\n    }\n    removeStep(stepFn) {\n        this.#steps.delete(stepFn);\n        return this;\n    }\n    run(event, data) {\n        const startEvent = event instanceof StartEvent ? event : new StartEvent(event);\n        return new WorkflowContext({\n            startEvent,\n            wait: this.#nextTick,\n            contextData: data,\n            steps: new Map(this.#steps),\n            timeout: this.#timeout,\n            verbose: this.#verbose,\n            queue: undefined,\n            pendingInputQueue: undefined,\n            resolved: null,\n            rejected: null\n        });\n    }\n    recover(data) {\n        const jsonString = new TextDecoder().decode(data);\n        const state = JSON.parse(jsonString);\n        const reconstructedStartEvent = new StartEvent(state.startEvent);\n        const AllEvents = [\n            ...this.#steps\n        ].map(([, { inputs, outputs }])=>[\n                ...inputs,\n                ...outputs ?? []\n            ]).flat();\n        const reconstructedQueue = state.queue.map((protocol)=>{\n            switch(protocol.type){\n                case \"requestEvent\":\n                    {\n                        const { requestEvent, id } = protocol;\n                        const EventType = AllEvents.find((type)=>type.prototype.constructor.name === requestEvent.constructor);\n                        if (!EventType) {\n                            throw new TypeError(`Event type not found: ${requestEvent.constructor}`);\n                        }\n                        return {\n                            type: \"requestEvent\",\n                            id,\n                            requestEvent: EventType\n                        };\n                    }\n                case \"event\":\n                    {\n                        const { event } = protocol;\n                        const EventType = AllEvents.find((type)=>type.prototype.constructor.name === event.constructor);\n                        if (!EventType) {\n                            throw new TypeError(`Event type not found: ${event.constructor}`);\n                        }\n                        return {\n                            type: \"event\",\n                            event: new EventType(event.data)\n                        };\n                    }\n            }\n        });\n        const reconstructedPendingInputQueue = state.pendingInputQueue.map((event)=>{\n            const EventType = AllEvents.find((type)=>type.prototype.constructor.name === event.constructor);\n            if (!EventType) {\n                throw new TypeError(`Event type not found: ${event.constructor}`);\n            }\n            return new EventType(event.data);\n        });\n        return new WorkflowContext({\n            startEvent: reconstructedStartEvent,\n            contextData: state.data,\n            wait: this.#nextTick,\n            steps: this.#steps,\n            timeout: state.timeout,\n            verbose: state.verbose,\n            queue: reconstructedQueue,\n            pendingInputQueue: reconstructedPendingInputQueue,\n            resolved: state.resolved ? new StopEvent(state.resolved) : null,\n            rejected: state.rejected ? new Error(state.rejected) : null\n        });\n    }\n}\n\nclass AgentToolCall extends WorkflowEvent {\n}\n// TODO: Check for if we need a raw tool output\nclass AgentToolCallResult extends WorkflowEvent {\n}\nclass AgentInput extends WorkflowEvent {\n}\nclass AgentSetup extends WorkflowEvent {\n}\nclass AgentStream extends WorkflowEvent {\n}\nclass AgentOutput extends WorkflowEvent {\n}\n\nconst DEFAULT_SYSTEM_PROMPT = \"You are a helpful assistant. Use the provided tools to answer questions.\";\nclass FunctionAgent {\n    constructor({ name, llm, description, tools, canHandoffTo, systemPrompt }){\n        this.name = name ?? \"Agent\";\n        this.llm = llm ?? Settings.llm;\n        if (!this.llm.supportToolCall) {\n            throw new Error(\"FunctionAgent requires an LLM that supports tool calls\");\n        }\n        this.description = description ?? \"A single agent that uses the provided tools or functions.\";\n        this.tools = tools;\n        if (tools.length === 0) {\n            throw new Error(\"FunctionAgent must have at least one tool\");\n        }\n        // Process canHandoffTo to extract agent names\n        this.canHandoffTo = [];\n        if (canHandoffTo) {\n            if (Array.isArray(canHandoffTo)) {\n                if (canHandoffTo.length > 0) {\n                    if (typeof canHandoffTo[0] === \"string\") {\n                        // string[] case\n                        this.canHandoffTo = canHandoffTo;\n                    } else if (canHandoffTo[0] instanceof AgentWorkflow) {\n                        // AgentWorkflow[] case\n                        const workflows = canHandoffTo;\n                        workflows.forEach((workflow)=>{\n                            const agentNames = workflow.getAgents().map((agent)=>agent.name);\n                            this.canHandoffTo.push(...agentNames);\n                        });\n                    } else {\n                        // BaseWorkflowAgent[] case\n                        const agents = canHandoffTo;\n                        this.canHandoffTo = agents.map((agent)=>agent.name);\n                    }\n                }\n            }\n        }\n        const uniqueHandoffAgents = new Set(this.canHandoffTo);\n        if (uniqueHandoffAgents.size !== this.canHandoffTo.length) {\n            throw new Error(\"Duplicate handoff agents\");\n        }\n        this.systemPrompt = systemPrompt ?? DEFAULT_SYSTEM_PROMPT;\n    }\n    async takeStep(ctx, llmInput, tools) {\n        // Get scratchpad from context or initialize if not present\n        const scratchpad = ctx.data.scratchpad;\n        const currentLLMInput = [\n            ...llmInput,\n            ...scratchpad\n        ];\n        const responseStream = await this.llm.chat({\n            messages: currentLLMInput,\n            tools,\n            stream: true\n        });\n        let response = \"\";\n        let lastChunk;\n        const toolCalls = new Map();\n        for await (const chunk of responseStream){\n            response += chunk.delta;\n            ctx.sendEvent(new AgentStream({\n                delta: chunk.delta,\n                response: response,\n                currentAgentName: this.name,\n                raw: chunk.raw\n            }));\n            const toolCallsInChunk = this.getToolCallFromResponseChunk(chunk);\n            if (toolCallsInChunk.length > 0) {\n                // Just upsert the tool calls with the latest one if they exist\n                toolCallsInChunk.forEach((toolCall)=>{\n                    toolCalls.set(toolCall.data.toolId, toolCall);\n                });\n            }\n        }\n        const message = {\n            role: \"assistant\",\n            content: response\n        };\n        if (toolCalls.size > 0) {\n            message.options = {\n                toolCall: Array.from(toolCalls.values()).map((toolCall)=>({\n                        name: toolCall.data.toolName,\n                        input: toolCall.data.toolKwargs,\n                        id: toolCall.data.toolId\n                    }))\n            };\n        }\n        scratchpad.push(message);\n        ctx.data.scratchpad = scratchpad;\n        return new AgentOutput({\n            response: message,\n            toolCalls: Array.from(toolCalls.values()),\n            raw: lastChunk?.raw,\n            currentAgentName: this.name\n        });\n    }\n    async handleToolCallResults(ctx, results) {\n        const scratchpad = ctx.data.scratchpad;\n        for (const result of results){\n            const content = result.data.toolOutput.result;\n            const rawToolMessage = {\n                role: \"user\",\n                content,\n                options: {\n                    toolResult: {\n                        id: result.data.toolId,\n                        result: content,\n                        isError: result.data.toolOutput.isError\n                    }\n                }\n            };\n            ctx.data.scratchpad.push(rawToolMessage);\n        }\n        ctx.data.scratchpad = scratchpad;\n    }\n    async finalize(ctx, output, memory) {\n        // Get scratchpad messages\n        const scratchpad = ctx.data.scratchpad;\n        for (const msg of scratchpad){\n            memory.put(msg);\n        }\n        // Clear scratchpad after finalization\n        ctx.data.scratchpad = [];\n        return output;\n    }\n    getToolCallFromResponseChunk(responseChunk) {\n        const toolCalls = [];\n        const options = responseChunk.options ?? {};\n        if (options && \"toolCall\" in options && Array.isArray(options.toolCall)) {\n            toolCalls.push(...options.toolCall.map((call)=>{\n                // Convert input to arguments format\n                let toolKwargs;\n                if (typeof call.input === \"string\") {\n                    try {\n                        toolKwargs = JSON.parse(call.input);\n                    } catch (e) {\n                        toolKwargs = {\n                            rawInput: call.input\n                        };\n                    }\n                } else {\n                    toolKwargs = call.input;\n                }\n                return new AgentToolCall({\n                    agentName: this.name,\n                    toolName: call.name,\n                    toolKwargs: toolKwargs,\n                    toolId: call.id\n                });\n            }));\n        }\n        const invalidToolCalls = toolCalls.filter((call)=>!this.tools.some((tool)=>tool.metadata.name === call.data.toolName));\n        if (invalidToolCalls.length > 0) {\n            const invalidToolNames = invalidToolCalls.map((call)=>call.data.toolName).join(\", \");\n            throw new Error(`Tools not found: ${invalidToolNames}`);\n        }\n        return toolCalls;\n    }\n}\n\nconst DEFAULT_HANDOFF_PROMPT = new PromptTemplate({\n    template: `Useful for handing off to another agent.\nIf you are currently not equipped to handle the user's request, or another agent is better suited to handle the request, please hand off to the appropriate agent.\n\nCurrently available agents: \n{agent_info}\n`\n});\nconst DEFAULT_HANDOFF_OUTPUT_PROMPT = new PromptTemplate({\n    template: `Agent {to_agent} is now handling the request due to the following reason: {reason}.\\nPlease continue with the current request.`\n});\n// Wrapper events for multiple tool calls and results\nclass ToolCallsEvent extends WorkflowEvent {\n}\nclass ToolResultsEvent extends WorkflowEvent {\n}\nclass AgentStepEvent extends WorkflowEvent {\n}\n/**\n * Create a multi-agent workflow\n * @param params - Parameters for the AgentWorkflow\n * @returns A new AgentWorkflow instance\n */ const multiAgent = (params)=>{\n    return new AgentWorkflow(params);\n};\n/**\n * Create a simple workflow with a single agent and specified tools\n * @param params - Parameters for the single agent workflow\n * @returns A new AgentWorkflow instance\n */ const agent = (params)=>{\n    return AgentWorkflow.fromTools(params);\n};\n/**\n * AgentWorkflow - An event-driven workflow for executing agents with tools\n *\n * This class provides a simple interface for creating and running agent workflows\n * based on the LlamaIndexTS workflow system. It supports single agent workflows\n * with multiple tools.\n */ class AgentWorkflow {\n    constructor({ agents, rootAgent, verbose, timeout }){\n        this.agents = new Map();\n        this.handleInputStep = async (ctx, event)=>{\n            const { userInput, chatHistory } = event.data;\n            const memory = ctx.data.memory;\n            if (chatHistory) {\n                chatHistory.forEach((message)=>{\n                    memory.put(message);\n                });\n            }\n            if (userInput) {\n                const userMessage = {\n                    role: \"user\",\n                    content: userInput\n                };\n                memory.put(userMessage);\n            } else if (chatHistory) {\n                // If no user message, use the last message from chat history as user_msg_str\n                const lastMessage = chatHistory[chatHistory.length - 1];\n                if (lastMessage?.role !== \"user\") {\n                    throw new Error(\"Either provide a user message or a chat history with a user message as the last message\");\n                }\n                ctx.data.userInput = lastMessage.content;\n            } else {\n                throw new Error(\"No user message or chat history provided\");\n            }\n            return new AgentInput({\n                input: await memory.getMessages(),\n                currentAgentName: this.rootAgentName\n            });\n        };\n        this.setupAgent = async (ctx, event)=>{\n            const currentAgentName = event.data.currentAgentName;\n            const agent = this.agents.get(currentAgentName);\n            if (!agent) {\n                throw new Error(`Agent ${currentAgentName} not found`);\n            }\n            const llmInput = event.data.input;\n            if (agent.systemPrompt) {\n                llmInput.unshift({\n                    role: \"system\",\n                    content: agent.systemPrompt\n                });\n            }\n            return new AgentSetup({\n                input: llmInput,\n                currentAgentName: currentAgentName\n            });\n        };\n        this.runAgentStep = async (ctx, event)=>{\n            const agent = this.agents.get(event.data.currentAgentName);\n            if (!agent) {\n                throw new Error(\"No valid agent found\");\n            }\n            if (this.verbose) {\n                console.log(`[Agent ${agent.name}]: Running for input: ${event.data.input[event.data.input.length - 1]?.content}`);\n            }\n            const output = await agent.takeStep(ctx, event.data.input, agent.tools);\n            ctx.sendEvent(output);\n            return new AgentStepEvent({\n                agentName: agent.name,\n                response: output.data.response,\n                toolCalls: output.data.toolCalls\n            });\n        };\n        this.parseAgentOutput = async (ctx, event)=>{\n            const { agentName, response, toolCalls } = event.data;\n            // If no tool calls, return final response\n            if (!toolCalls || toolCalls.length === 0) {\n                if (this.verbose) {\n                    console.log(`[Agent ${agentName}]: No tool calls to process, returning final response`);\n                }\n                const agentOutput = new AgentOutput({\n                    response,\n                    toolCalls: [],\n                    raw: response,\n                    currentAgentName: agentName\n                });\n                const content = await this.agents.get(agentName)?.finalize(ctx, agentOutput, ctx.data.memory);\n                return new StopEvent({\n                    result: content?.data.response.content\n                });\n            }\n            return new ToolCallsEvent({\n                agentName,\n                toolCalls\n            });\n        };\n        this.executeToolCalls = async (ctx, event)=>{\n            const { agentName, toolCalls } = event.data;\n            const agent = this.agents.get(agentName);\n            if (!agent) {\n                throw new Error(`Agent ${agentName} not found`);\n            }\n            const results = [];\n            // Execute each tool call\n            for (const toolCall of toolCalls){\n                // Send single tool call event, useful for UI\n                ctx.sendEvent(toolCall);\n                const toolResult = new AgentToolCallResult({\n                    toolName: toolCall.data.toolName,\n                    toolKwargs: toolCall.data.toolKwargs,\n                    toolId: toolCall.data.toolId,\n                    toolOutput: {\n                        id: toolCall.data.toolId,\n                        result: \"\",\n                        isError: false\n                    },\n                    returnDirect: false\n                });\n                try {\n                    const output = await this.callTool(toolCall, ctx);\n                    toolResult.data.toolOutput.result = stringifyJSONToMessageContent(output);\n                    toolResult.data.returnDirect = toolCall.data.toolName === \"handOff\";\n                } catch (error) {\n                    toolResult.data.toolOutput.isError = true;\n                    toolResult.data.toolOutput.result = `Error: ${error}`;\n                }\n                results.push(toolResult);\n                // Send single tool result event, useful for UI\n                ctx.sendEvent(toolResult);\n            }\n            return new ToolResultsEvent({\n                agentName,\n                results\n            });\n        };\n        this.processToolResults = async (ctx, event)=>{\n            const { agentName, results } = event.data;\n            // Get agent\n            const agent = this.agents.get(agentName);\n            if (!agent) {\n                throw new Error(`Agent ${agentName} not found`);\n            }\n            await agent.handleToolCallResults(ctx, results);\n            const directResult = results.find((r)=>r.data.returnDirect);\n            if (directResult) {\n                const isHandoff = directResult.data.toolName === \"handOff\";\n                const output = typeof directResult.data.toolOutput.result === \"string\" ? directResult.data.toolOutput.result : JSON.stringify(directResult.data.toolOutput.result);\n                const agentOutput = new AgentOutput({\n                    response: {\n                        role: \"assistant\",\n                        content: output\n                    },\n                    toolCalls: [],\n                    raw: output,\n                    currentAgentName: agent.name\n                });\n                await agent.finalize(ctx, agentOutput, ctx.data.memory);\n                if (isHandoff) {\n                    const nextAgentName = ctx.data.nextAgentName;\n                    console.log(`[Agent ${agentName}]: Handoff to ${nextAgentName}: ${directResult.data.toolOutput.result}`);\n                    if (nextAgentName) {\n                        ctx.data.currentAgentName = nextAgentName;\n                        ctx.data.nextAgentName = null;\n                        const messages = await ctx.data.memory.getMessages();\n                        return new AgentInput({\n                            input: messages,\n                            currentAgentName: nextAgentName\n                        });\n                    }\n                }\n                return new StopEvent({\n                    result: output\n                });\n            }\n            // Continue with another agent step\n            const messages = await ctx.data.memory.getMessages();\n            return new AgentInput({\n                input: messages,\n                currentAgentName: agent.name\n            });\n        };\n        this.workflow = new Workflow({\n            verbose: verbose ?? false,\n            timeout: timeout ?? 60\n        });\n        this.verbose = verbose ?? false;\n        // Handle AgentWorkflow cases for agents\n        const processedAgents = [];\n        if (agents.length > 0) {\n            if (agents[0] instanceof AgentWorkflow) {\n                // If agents is AgentWorkflow[], extract the BaseWorkflowAgent from each workflow\n                const agentWorkflows = agents;\n                agentWorkflows.forEach((workflow)=>{\n                    const workflowAgents = workflow.getAgents();\n                    processedAgents.push(...workflowAgents);\n                });\n            } else {\n                // Otherwise, agents is already BaseWorkflowAgent[]\n                processedAgents.push(...agents);\n            }\n        }\n        // Handle AgentWorkflow case for rootAgent and set rootAgentName\n        if (rootAgent instanceof AgentWorkflow) {\n            // If rootAgent is an AgentWorkflow, check if it has exactly one agent\n            const rootAgents = rootAgent.getAgents();\n            if (rootAgents.length !== 1) {\n                throw new Error(`Root agent must be a single agent, but it is a workflow with ${rootAgents.length} agents`);\n            }\n            // We know rootAgents[0] exists because we checked length === 1 above\n            this.rootAgentName = rootAgents[0].name;\n        } else {\n            // Otherwise, rootAgent is already a BaseWorkflowAgent\n            this.rootAgentName = rootAgent.name;\n        }\n        // Validate root agent\n        if (!processedAgents.some((a)=>a.name === this.rootAgentName)) {\n            throw new Error(`Root agent ${this.rootAgentName} not found in agents`);\n        }\n        this.addAgents(processedAgents);\n    }\n    validateAgent(agent) {\n        // Validate that all canHandoffTo agents exist\n        const invalidAgents = agent.canHandoffTo.filter((name)=>!this.agents.has(name));\n        if (invalidAgents.length > 0) {\n            throw new Error(`Agent \"${agent.name}\" references non-existent agents in canHandoffTo: ${invalidAgents.join(\", \")}`);\n        }\n    }\n    addHandoffTool(agent) {\n        const handoffTool = createHandoffTool(this.agents);\n        if (agent.canHandoffTo.length > 0 && !agent.tools.some((t)=>t.metadata.name === handoffTool.metadata.name)) {\n            agent.tools.push(handoffTool);\n        }\n    }\n    addAgents(agents) {\n        const agentNames = new Set(agents.map((a)=>a.name));\n        if (agentNames.size !== agents.length) {\n            throw new Error(\"The agent names must be unique!\");\n        }\n        // First pass: add all agents to the map\n        agents.forEach((agent)=>{\n            this.agents.set(agent.name, agent);\n        });\n        // Second pass: validate and setup handoff tools\n        agents.forEach((agent)=>{\n            this.validateAgent(agent);\n            this.addHandoffTool(agent);\n        });\n    }\n    /**\n   * Adds a new agent to the workflow\n   */ addAgent(agent) {\n        this.agents.set(agent.name, agent);\n        this.validateAgent(agent);\n        this.addHandoffTool(agent);\n        return this;\n    }\n    /**\n   * Gets all agents in this workflow\n   * @returns Array of agents in this workflow\n   */ getAgents() {\n        return Array.from(this.agents.values());\n    }\n    /**\n   * Create a simple workflow with a single agent and specified tools\n   * @param params - Parameters for the single agent workflow\n   * @returns A new AgentWorkflow instance\n   */ static fromTools(params) {\n        const agent = new FunctionAgent({\n            name: params.name,\n            description: params.description,\n            tools: params.tools,\n            llm: params.llm,\n            systemPrompt: params.systemPrompt\n        });\n        const workflow = new AgentWorkflow({\n            agents: [\n                agent\n            ],\n            rootAgent: agent,\n            verbose: params.verbose ?? false,\n            timeout: params.timeout ?? 60\n        });\n        return workflow;\n    }\n    setupWorkflowSteps() {\n        this.workflow.addStep({\n            inputs: [\n                StartEvent\n            ],\n            outputs: [\n                AgentInput\n            ]\n        }, this.handleInputStep);\n        this.workflow.addStep({\n            inputs: [\n                AgentInput\n            ],\n            outputs: [\n                AgentSetup\n            ]\n        }, this.setupAgent);\n        this.workflow.addStep({\n            inputs: [\n                AgentSetup\n            ],\n            outputs: [\n                AgentStepEvent\n            ]\n        }, this.runAgentStep);\n        this.workflow.addStep({\n            inputs: [\n                AgentStepEvent\n            ],\n            outputs: [\n                ToolCallsEvent,\n                StopEvent\n            ]\n        }, this.parseAgentOutput);\n        this.workflow.addStep({\n            inputs: [\n                ToolCallsEvent\n            ],\n            outputs: [\n                ToolResultsEvent,\n                StopEvent\n            ]\n        }, this.executeToolCalls);\n        this.workflow.addStep({\n            inputs: [\n                ToolResultsEvent\n            ],\n            outputs: [\n                AgentInput,\n                StopEvent\n            ]\n        }, this.processToolResults);\n        return this;\n    }\n    callTool(toolCall, ctx) {\n        const tool = this.agents.get(toolCall.data.agentName)?.tools.find((t)=>t.metadata.name === toolCall.data.toolName);\n        if (!tool) {\n            throw new Error(`Tool ${toolCall.data.toolName} not found`);\n        }\n        if (tool.metadata.requireContext) {\n            const input = {\n                context: ctx.data,\n                ...toolCall.data.toolKwargs\n            };\n            return tool.call(input);\n        } else {\n            return tool.call(toolCall.data.toolKwargs);\n        }\n    }\n    run(userInput, params) {\n        if (this.agents.size === 0) {\n            throw new Error(\"No agents added to workflow\");\n        }\n        this.setupWorkflowSteps();\n        const contextData = params?.context ?? {\n            userInput: userInput,\n            memory: new ChatMemoryBuffer(),\n            scratchpad: [],\n            currentAgentName: this.rootAgentName,\n            agents: Array.from(this.agents.keys()),\n            nextAgentName: null\n        };\n        const result = this.workflow.run({\n            userInput: userInput,\n            chatHistory: params?.chatHistory\n        }, contextData);\n        return result;\n    }\n}\nconst createHandoffTool = (agents)=>{\n    const agentInfo = Array.from(agents.values()).reduce((acc, a)=>{\n        acc[a.name] = a.description;\n        return acc;\n    }, {});\n    return FunctionTool.from(({ context, toAgent, reason })=>{\n        if (!context) {\n            throw new Error(\"Context is required for handoff\");\n        }\n        const agents = context.agents;\n        if (!agents.includes(toAgent)) {\n            return `Agent ${toAgent} not found. Select a valid agent to hand off to. Valid agents: ${agents.join(\", \")}`;\n        }\n        context.nextAgentName = toAgent;\n        return DEFAULT_HANDOFF_OUTPUT_PROMPT.format({\n            to_agent: toAgent,\n            reason: reason\n        });\n    }, {\n        name: \"handOff\",\n        description: DEFAULT_HANDOFF_PROMPT.format({\n            agent_info: JSON.stringify(agentInfo)\n        }),\n        parameters: z.object({\n            toAgent: z.string({\n                description: \"The name of the agent to hand off to\"\n            }),\n            reason: z.string({\n                description: \"The reason for handing off to the agent\"\n            })\n        }),\n        requireContext: true\n    });\n};\n\nexport { AgentInput, AgentOutput, AgentSetup, AgentStepEvent, AgentStream, AgentToolCall, AgentToolCallResult, AgentWorkflow, FunctionAgent, ToolCallsEvent, ToolResultsEvent, agent, multiAgent };\n"],"names":[],"mappings":"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","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 3165, "column": 0}, "map": {"version":3,"sources":["file:///C:/app/agentset/node_modules/%40llamaindex/node-parser/code/dist/index.js"],"sourcesContent":["import { Settings } from '@llamaindex/core/global';\nimport { TextSplitter } from '@llamaindex/core/node-parser';\n\nconst DEFAULT_MAX_CHARS = 1500;\nclass CodeSplitter extends TextSplitter {\n    #parser;\n    constructor(params){\n        super(), this.maxChars = DEFAULT_MAX_CHARS;\n        this.#parser = params.getParser();\n        if (params.maxChars) {\n            this.maxChars = params.maxChars;\n        }\n    }\n    #chunkNode(node, text, lastEnd = 0) {\n        let newChunks = [];\n        let currentChunk = \"\";\n        for (const child of node.children){\n            if (child.endIndex - child.startIndex > this.maxChars) {\n                // Child is too big, recursively chunk the child\n                if (currentChunk.length > 0) {\n                    newChunks.push(currentChunk.trim());\n                    currentChunk = \"\";\n                }\n                newChunks = newChunks.concat(this.#chunkNode(child, text, lastEnd));\n            } else if (currentChunk.length + (child.endIndex - child.startIndex) > this.maxChars) {\n                // Child would make the current chunk too big, so start a new chunk\n                newChunks.push(currentChunk.trim());\n                currentChunk = text.slice(lastEnd, child.endIndex);\n            } else {\n                currentChunk += text.slice(lastEnd, child.endIndex);\n            }\n            lastEnd = child.endIndex;\n        }\n        if (currentChunk.length > 0) {\n            newChunks.push(currentChunk.trim());\n        }\n        return newChunks;\n    }\n    splitText(text) {\n        const callbackManager = Settings.callbackManager;\n        callbackManager.dispatchEvent(\"chunking-start\", {\n            text: [\n                text\n            ]\n        });\n        const tree = this.#parser.parse(text);\n        const rootNode = tree.rootNode;\n        if (rootNode.children.length === 0 || rootNode.children[0]?.type === \"ERROR\") {\n            throw new Error(\"Could not parse code with language\");\n        } else {\n            const chunks = this.#chunkNode(rootNode, text);\n            callbackManager.dispatchEvent(\"chunking-end\", {\n                chunks\n            });\n            return chunks;\n        }\n    }\n}\n\nexport { CodeSplitter, DEFAULT_MAX_CHARS };\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,oBAAoB;AAC1B,MAAM,qBAAqB,uKAAA,CAAA,eAAY;IACnC,CAAA,MAAO,CAAC;IACR,YAAY,MAAM,CAAC;QACf,KAAK,IAAI,IAAI,CAAC,QAAQ,GAAG;QACzB,IAAI,CAAC,CAAA,MAAO,GAAG,OAAO,SAAS;QAC/B,IAAI,OAAO,QAAQ,EAAE;YACjB,IAAI,CAAC,QAAQ,GAAG,OAAO,QAAQ;QACnC;IACJ;IACA,CAAA,SAAU,CAAC,IAAI,EAAE,IAAI,EAAE,UAAU,CAAC;QAC9B,IAAI,YAAY,EAAE;QAClB,IAAI,eAAe;QACnB,KAAK,MAAM,SAAS,KAAK,QAAQ,CAAC;YAC9B,IAAI,MAAM,QAAQ,GAAG,MAAM,UAAU,GAAG,IAAI,CAAC,QAAQ,EAAE;gBACnD,gDAAgD;gBAChD,IAAI,aAAa,MAAM,GAAG,GAAG;oBACzB,UAAU,IAAI,CAAC,aAAa,IAAI;oBAChC,eAAe;gBACnB;gBACA,YAAY,UAAU,MAAM,CAAC,IAAI,CAAC,CAAA,SAAU,CAAC,OAAO,MAAM;YAC9D,OAAO,IAAI,aAAa,MAAM,GAAG,CAAC,MAAM,QAAQ,GAAG,MAAM,UAAU,IAAI,IAAI,CAAC,QAAQ,EAAE;gBAClF,mEAAmE;gBACnE,UAAU,IAAI,CAAC,aAAa,IAAI;gBAChC,eAAe,KAAK,KAAK,CAAC,SAAS,MAAM,QAAQ;YACrD,OAAO;gBACH,gBAAgB,KAAK,KAAK,CAAC,SAAS,MAAM,QAAQ;YACtD;YACA,UAAU,MAAM,QAAQ;QAC5B;QACA,IAAI,aAAa,MAAM,GAAG,GAAG;YACzB,UAAU,IAAI,CAAC,aAAa,IAAI;QACpC;QACA,OAAO;IACX;IACA,UAAU,IAAI,EAAE;QACZ,MAAM,kBAAkB,+JAAA,CAAA,WAAQ,CAAC,eAAe;QAChD,gBAAgB,aAAa,CAAC,kBAAkB;YAC5C,MAAM;gBACF;aACH;QACL;QACA,MAAM,OAAO,IAAI,CAAC,CAAA,MAAO,CAAC,KAAK,CAAC;QAChC,MAAM,WAAW,KAAK,QAAQ;QAC9B,IAAI,SAAS,QAAQ,CAAC,MAAM,KAAK,KAAK,SAAS,QAAQ,CAAC,EAAE,EAAE,SAAS,SAAS;YAC1E,MAAM,IAAI,MAAM;QACpB,OAAO;YACH,MAAM,SAAS,IAAI,CAAC,CAAA,SAAU,CAAC,UAAU;YACzC,gBAAgB,aAAa,CAAC,gBAAgB;gBAC1C;YACJ;YACA,OAAO;QACX;IACJ;AACJ","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 3235, "column": 0}, "map": {"version":3,"sources":["file:///C:/app/agentset/node_modules/%40llamaindex/node-parser/html/dist/index.js"],"sourcesContent":["import { NodeParser } from '@llamaindex/core/node-parser';\nimport { MetadataMode, buildNodeFromSplits } from '@llamaindex/core/schema';\nimport { htmlToText } from 'html-to-text';\n\nclass HTMLNodeParser extends NodeParser {\n    constructor(params){\n        super(), this.htmlToTextOptions = undefined;\n        if (params?.htmlToTextOptions) {\n            this.htmlToTextOptions = params.htmlToTextOptions;\n        }\n    }\n    parseNodes(documents) {\n        const nodes = [];\n        for (const document of documents){\n            const text = htmlToText(document.getContent(MetadataMode.NONE), this.htmlToTextOptions);\n            nodes.push(...buildNodeFromSplits([\n                text\n            ], document));\n        }\n        return nodes;\n    }\n}\n\nexport { HTMLNodeParser };\n"],"names":[],"mappings":";;;AAAA;AACA;AACA;;;;AAEA,MAAM,uBAAuB,uKAAA,CAAA,aAAU;IACnC,YAAY,MAAM,CAAC;QACf,KAAK,IAAI,IAAI,CAAC,iBAAiB,GAAG;QAClC,IAAI,QAAQ,mBAAmB;YAC3B,IAAI,CAAC,iBAAiB,GAAG,OAAO,iBAAiB;QACrD;IACJ;IACA,WAAW,SAAS,EAAE;QAClB,MAAM,QAAQ,EAAE;QAChB,KAAK,MAAM,YAAY,UAAU;YAC7B,MAAM,OAAO,CAAA,GAAA,gKAAA,CAAA,aAAU,AAAD,EAAE,SAAS,UAAU,CAAC,+JAAA,CAAA,eAAY,CAAC,IAAI,GAAG,IAAI,CAAC,iBAAiB;YACtF,MAAM,IAAI,IAAI,CAAA,GAAA,+JAAA,CAAA,sBAAmB,AAAD,EAAE;gBAC9B;aACH,EAAE;QACP;QACA,OAAO;IACX;AACJ","ignoreList":[0],"debugId":null}}]
}